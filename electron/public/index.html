<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘½ä»¤ç®¡ç†å·¥å…·</title>
    <style>
    :root {
        /* é¢œè‰²ç³»ç»Ÿ */
        --color-primary: #3b82f6;
        --color-primary-hover: #2563eb;
        --color-primary-active: #1d4ed8;
        --color-secondary: #6b7280;
        --color-success: #10b981;
        --color-warning: #f59e0b;
        --color-danger: #ef4444;
        --color-info: #06b6d4;
        --color-purple: #764ba2;
        --color-primary-shadow: rgba(59, 130, 246, 0.1);
        
        /* ä¸­æ€§è‰² */
        --color-white: #ffffff;
        --color-gray-50: #f9fafb;
        --color-gray-100: #f3f4f6;
        --color-gray-200: #e5e7eb;
        --color-gray-300: #d1d5db;
        --color-gray-400: #9ca3af;
        --color-gray-500: #6b7280;
        --color-gray-600: #4b5563;
        --color-gray-700: #374151;
        --color-gray-800: #1f2937;
        --color-gray-900: #111827;
        --color-black: #000000;
        
        /* æ–‡æœ¬é¢œè‰² */
        --text-primary: var(--color-gray-900);
        --text-secondary: var(--color-gray-600);
        --text-muted: var(--color-gray-500);
        --text-inverse: var(--color-white);
        
        /* èƒŒæ™¯é¢œè‰² */
        --bg-primary: var(--color-white);
        --bg-secondary: var(--color-gray-50);
        --bg-muted: var(--color-gray-100);
        --bg-overlay: rgba(0, 0, 0, 0.5);
        
        /* è¾¹æ¡†é¢œè‰² */
        --border-primary: var(--color-gray-200);
        --border-secondary: var(--color-gray-300);
        --border-muted: var(--color-gray-100);
        
        /* åœ†è§’ç³»ç»Ÿ */
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --radius-xl: 16px;
        --radius-full: 9999px;
        
        /* è¾¹æ¡†å®½åº¦ */
        --border-width-sm: 1px;
        --border-width-md: 2px;
        --border-width-lg: 3px;
        
        /* é˜´å½±ç³»ç»Ÿ */
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        
        /* å°ºå¯¸ç³»ç»Ÿ */
        --size-8: 32px;
        --sidebar-width: 280px;
        --modal-max-width: 600px;
        --vh-60: 60vh;
        --vh-80: 80vh;
        --vh-100: 100vh;
        
        /* é—´è·ç³»ç»Ÿ */
        --space-1: 4px;
        --space-2: 8px;
        --space-3: 12px;
        --space-4: 16px;
        --space-5: 20px;
        --space-6: 24px;
        --space-8: 32px;
        --space-10: 40px;
        --space-12: 48px;
        --space-16: 64px;
        
        /* å­—ä½“ç³»ç»Ÿ */
        --font-family-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        --font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        
        /* å­—ä½“å¤§å° */
        --text-xs: 12px;
        --text-sm: 14px;
        --text-base: 16px;
        --text-lg: 18px;
        --text-xl: 20px;
        --text-2xl: 24px;
        --text-3xl: 30px;
        
        /* å­—ä½“ç²—ç»† */
        --font-light: 300;
        --font-normal: 400;
        --font-medium: 500;
        --font-semibold: 600;
        --font-bold: 700;
        
        /* è¿‡æ¸¡åŠ¨ç”» */
        --transition-fast: 150ms ease-in-out;
        --transition-normal: 200ms ease-in-out;
        --transition-slow: 300ms ease-in-out;
        
        /* è§†è§‰ä¼˜åŒ– - æ¸å˜è‰²å½© */
        --gradient-primary: linear-gradient(135deg, var(--color-primary), var(--color-primary-active));
        --gradient-card: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.98));
        --gradient-sidebar: linear-gradient(180deg, var(--color-primary), var(--color-primary-active));
        
        /* è§†è§‰ä¼˜åŒ– - å¢å¼ºé˜´å½± */
        --shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.15);
        --shadow-focus: 0 0 0 3px rgba(59, 130, 246, 0.1);
        
        /* è§†è§‰ä¼˜åŒ– - ç¼“åŠ¨å‡½æ•° */
        --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
        --ease-in-out-back: cubic-bezier(0.68, -0.6, 0.32, 1.6);
        
        /* å±‚çº§ */
        --z-dropdown: 1000;
        --z-sticky: 1020;
        --z-fixed: 1030;
        --z-modal-backdrop: 1040;
        --z-modal: 1050;
        --z-popover: 1060;
        --z-tooltip: 1070;
        
        /* æ·±è‰²ä¸»é¢˜å˜é‡ */
        --color-scheme: light;
    }
    
    /* æ·±è‰²ä¸»é¢˜ */
    [data-theme="dark"] {
        --color-scheme: dark;
        
        /* é¢œè‰²ç³»ç»Ÿ - æ·±è‰²ä¸»é¢˜ */
        --color-primary: #60a5fa;
        --color-primary-hover: #3b82f6;
        --color-primary-active: #2563eb;
        --color-primary-shadow: rgba(96, 165, 250, 0.2);
        
        /* ä¸­æ€§è‰² - æ·±è‰²ä¸»é¢˜ */
        --color-white: #ffffff;
        --color-gray-50: #f9fafb;
        --color-gray-100: #f3f4f6;
        --color-gray-200: #e5e7eb;
        --color-gray-300: #d1d5db;
        --color-gray-400: #9ca3af;
        --color-gray-500: #6b7280;
        --color-gray-600: #4b5563;
        --color-gray-700: #374151;
        --color-gray-800: #1f2937;
        --color-gray-900: #111827;
        --color-black: #000000;
        
        /* æ–‡æœ¬é¢œè‰² - æ·±è‰²ä¸»é¢˜ */
        --text-primary: #f3f4f6;
        --text-secondary: #d1d5db;
        --text-muted: #9ca3af;
        --text-inverse: #1f2937;
        
        /* èƒŒæ™¯é¢œè‰² - æ·±è‰²ä¸»é¢˜ */
        --bg-primary: #1f2937;
        --bg-secondary: #111827;
        --bg-muted: #374151;
        --bg-overlay: rgba(0, 0, 0, 0.7);
        
        /* è¾¹æ¡†é¢œè‰² - æ·±è‰²ä¸»é¢˜ */
        --border-primary: #374151;
        --border-secondary: #4b5563;
        --border-muted: #374151;
        
        /* é˜´å½±ç³»ç»Ÿ - æ·±è‰²ä¸»é¢˜ */
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.4);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.5);
        --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.6);
        --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.7);
        
        /* è§†è§‰ä¼˜åŒ– - æ·±è‰²ä¸»é¢˜æ¸å˜ */
        --gradient-primary-dark: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));
        --gradient-card-dark: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(31, 41, 55, 0.98));
        --gradient-sidebar-dark: linear-gradient(180deg, var(--color-primary), var(--color-primary-hover));
    }
    
    /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’®æ ·å¼ */
        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 8px 16px;
            border: 2px solid var(--border-primary);
            border-radius: var(--radius-lg);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
            margin: var(--space-4) auto;
            width: fit-content;
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: var(--color-white);
        }

        .theme-toggle:active {
            transform: translateY(0);
        }

        .theme-icon {
            font-size: 18px;
            transition: transform var(--transition-fast);
        }

        .theme-toggle:hover .theme-icon {
            transform: rotate(180deg);
        }

        .theme-text {
            white-space: nowrap;
        }

        /* æ·±è‰²ä¸»é¢˜æ ·å¼è¦†ç›– */
        [data-theme="dark"] .sidebar,
        :root:not([data-theme]) .sidebar {
            background: var(--gradient-sidebar-dark);
            border-right-color: var(--border-primary);
        }

        [data-theme="dark"] .command-card,
        :root:not([data-theme]) .command-card {
            background: var(--gradient-card-dark);
            border-color: var(--border-primary);
            box-shadow: var(--shadow-sm);
        }

        [data-theme="dark"] .command-card:hover,
        :root:not([data-theme]) .command-card:hover {
            background: var(--bg-secondary);
            border-color: var(--color-primary);
            box-shadow: var(--shadow-md);
        }

        [data-theme="dark"] .search-input,
        :root:not([data-theme]) .search-input {
            background: var(--bg-muted);
            border-color: var(--border-primary);
            color: var(--text-primary);
        }

        [data-theme="dark"] .search-input:focus,
        :root:not([data-theme]) .search-input:focus {
            border-color: var(--color-primary);
            background: var(--bg-primary);
        }

        [data-theme="dark"] .category-item,
        :root:not([data-theme]) .category-item {
            color: var(--text-secondary);
        }

        [data-theme="dark"] .category-item:hover,
        :root:not([data-theme]) .category-item:hover {
            background: var(--bg-muted);
            color: var(--text-primary);
        }

        [data-theme="dark"] .category-item.active,
        :root:not([data-theme]) .category-item.active {
            background: var(--color-primary);
            color: var(--color-white);
        }

        [data-theme="dark"] .action-button,
        :root:not([data-theme]) .action-button {
            background: var(--bg-muted);
            color: var(--text-secondary);
            border-color: var(--border-primary);
        }

        [data-theme="dark"] .action-button:hover,
        :root:not([data-theme]) .action-button:hover {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        [data-theme="dark"] .modal-content,
        :root:not([data-theme]) .modal-content {
            background: var(--bg-primary);
            border-color: var(--border-primary);
        }

        [data-theme="dark"] .modal-header,
        :root:not([data-theme]) .modal-header {
            border-bottom-color: var(--border-primary);
        }

        [data-theme="dark"] .modal-footer,
        :root:not([data-theme]) .modal-footer {
            border-top-color: var(--border-primary);
        }

        [data-theme="dark"] .toast,
        :root:not([data-theme]) .toast {
            background: var(--bg-primary);
            border-color: var(--border-primary);
            color: var(--text-primary);
            box-shadow: var(--shadow-lg);
        }

        /* æ·±è‰²ä¸»é¢˜ä¸‹ç»Ÿè®¡é¢æ¿æ ·å¼ */
        [data-theme="dark"] .sidebar > div:has(#statsPanel),
        :root:not([data-theme]) .sidebar > div:has(#statsPanel) {
            background: var(--color-gray-800) !important;
            border-top-color: var(--color-gray-700) !important;
        }

        [data-theme="dark"] .sidebar > div:has(#statsPanel) > div:first-child,
        :root:not([data-theme]) .sidebar > div:has(#statsPanel) > div:first-child {
            color: var(--color-gray-300) !important;
        }

        [data-theme="dark"] #statsPanel,
        :root:not([data-theme]) #statsPanel {
            color: var(--color-gray-400) !important;
        }

        /* æ·±è‰²ä¸»é¢˜ä¸‹ä½¿ç”¨æŒ‡å—æŒ‰é’®æ ·å¼ */
        [data-theme="dark"] .sidebar > div:has(button[onclick="showHelpModal()"]),
        :root:not([data-theme]) .sidebar > div:has(button[onclick="showHelpModal()"]) {
            background: var(--color-gray-800) !important;
            border-top-color: var(--color-gray-700) !important;
        }

        [data-theme="dark"] .sidebar > div:has(button[onclick="showHelpModal()"]) button,
        :root:not([data-theme]) .sidebar > div:has(button[onclick="showHelpModal()"]) button {
            background: var(--color-gray-700) !important;
            border-color: var(--color-gray-600) !important;
            color: var(--color-gray-200) !important;
        }

        [data-theme="dark"] .sidebar > div:has(button[onclick="showHelpModal()"]) button:hover,
        :root:not([data-theme]) .sidebar > div:has(button[onclick="showHelpModal()"]) button:hover {
            background: var(--color-gray-600) !important;
            border-color: var(--color-gray-500) !important;
        }

        /* ç³»ç»Ÿä¸»é¢˜æ£€æµ‹ */
        @media (prefers-color-scheme: dark) {
        :root:not([data-theme]) {
            --color-scheme: dark;
            
            /* åº”ç”¨æ·±è‰²ä¸»é¢˜å˜é‡ */
            --color-primary: #60a5fa;
            --color-primary-hover: #3b82f6;
            --color-primary-active: #2563eb;
            --color-primary-shadow: rgba(96, 165, 250, 0.2);
            
            --text-primary: #f3f4f6;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --bg-muted: #374151;
            
            --border-primary: #374151;
            --border-secondary: #4b5563;
            
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.4);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.6);
        }
    }
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

        body {
            font-family: var(--font-family-sans);
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-muted) 100%);
            color: var(--text-primary);
            height: var(--vh-100);
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        
        .app {
            display: flex;
            height: var(--vh-100);
            animation: appEntrance 0.8s var(--ease-out-back) both;

        .sidebar {
            width: var(--sidebar-width);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-lg);
        }

        .sidebar-header {
            padding: var(--space-6);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
            position: relative;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-6);
        }

        .logo-icon {
            width: var(--size-8);
            height: var(--size-8);
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-purple) 100%);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-white);
            font-weight: var(--font-bold);
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);
            transition: all var(--transition-normal);
        }

        .logo-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.4);
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: var(--space-4) var(--space-4) var(--space-4) calc(var(--space-4) + var(--space-6));
            border: 2px solid transparent;
            border-radius: var(--radius-xl);
            font-size: var(--text-sm);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all var(--transition-normal);
            color: var(--text-primary);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--color-primary);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-icon {
            position: absolute;
            left: var(--space-3);
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-gray-400);
        }

        .categories {
            flex: 1;
            padding: var(--space-5);
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .category-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0) 100%);
            opacity: 0;
            transition: opacity var(--transition-normal);
            z-index: -1;
        }

        .category-item:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateX(4px);
        }

        .category-item:hover::before {
            opacity: 1;
        }

        .category-item.active {
            background: var(--color-primary);
            color: var(--color-white);
            font-weight: var(--font-semibold);
            transform: translateX(8px);
        }

        .category-item.active::before {
            opacity: 1;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0) 100%);
        }

        .category-color {
            width: var(--space-3);
            height: var(--space-3);
            border-radius: 50%;
        }

        .category-count {
            margin-left: auto;
            background: var(--color-gray-100);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-xl);
            font-size: var(--text-xs);
            color: var(--color-gray-500);
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            padding: var(--space-5) var(--space-6);
            border-bottom: 1px solid var(--border-primary);
            background: var(--bg-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: var(--text-2xl);
            font-weight: var(--font-semibold);
            color: var(--color-gray-900);
        }

        [data-theme="dark"] .header-title,
        :root:not([data-theme]) .header-title {
            color: var(--text-primary);
        }

        .add-button {
            background: var(--color-primary);
            color: var(--color-white);
            border: none;
            padding: var(--space-2) var(--space-5);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: background-color var(--transition-normal);
        }

        .add-button:hover {
            background: var(--color-primary-hover);
        }

        .commands-container {
            flex: 1;
            padding: var(--space-6);
            overflow-y: auto;
            background: var(--bg-secondary);
        }

        .command-card {
            background: var(--gradient-card);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-xl);
            padding: var(--space-5);
            margin-bottom: var(--space-4);
            transition: all var(--transition-normal);
            cursor: default;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
            transform-origin: center;
            animation: cardEntrance 0.6s var(--ease-out-back) both;
        }
    
            .command-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0) 50%);
                opacity: 0;
                transition: opacity var(--transition-normal);
                z-index: 1;
            }
    
            .command-card:hover {
                transform: translateY(-6px) scale(1.03);
                box-shadow: var(--shadow-hover);
                background: var(--gradient-card);
                border-color: rgba(59, 130, 246, 0.4);
                animation: cardHover 0.4s var(--ease-out-back) both;
            }
    
            .command-card:hover::before {
                opacity: 1;
            }
    
            .command-card:active {
                transform: translateY(-2px) scale(1.01);
                box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
            }
        }

        .command-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-3);
        }

        .command-name {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--color-gray-900);
            margin-bottom: var(--space-1);
        }

        [data-theme="dark"] .command-name,
        :root:not([data-theme]) .command-name {
            color: var(--text-primary);
        }

        .command-category {
            display: flex;
            align-items: center;
            gap: var(--space-1_5);
            font-size: var(--text-xs);
            color: var(--color-gray-500);
        }

        .command-actions {
            display: flex;
            gap: var(--space-2);
        }

        .action-button {
            padding: var(--space-2);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            border: none;
            background: transparent;
            color: var(--color-gray-500);
            position: relative;
            overflow: hidden;
            z-index: 2;
            transform-origin: center;
        }
        
        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0) 100%);
            opacity: 0;
            transition: opacity var(--transition-normal);
            border-radius: var(--radius-md);
        }
        
        .action-button:hover {
            color: var(--color-primary);
            background: var(--color-gray-100);
            transform: scale(1.15);
            box-shadow: var(--shadow-sm);
            animation: buttonPulse 0.6s var(--ease-out-back) both;
        }
        
        .action-button:hover::before {
            opacity: 1;
        }
        
        .action-button.primary {
            color: var(--color-primary);
        }
        
        .action-button.primary:hover {
            background: var(--gradient-primary);
            color: var(--color-white);
            transform: scale(1.15);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            animation: buttonPulse 0.6s var(--ease-out-back) both;
        }
            
        .action-button.favorite {
            color: var(--color-warning);
        }
            
        .action-button.favorite:hover {
            background: linear-gradient(135deg, var(--color-warning), #f97316);
            color: var(--color-white);
            transform: scale(1.15);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
            animation: buttonPulse 0.6s var(--ease-out-back) both;
        }

        .command-code {
            background: var(--color-gray-100);
            padding: var(--space-3);
            border-radius: var(--radius-md);
            font-family: var(--font-family-mono);
            font-size: var(--text-sm);
            color: var(--color-gray-700);
            margin: var(--space-3) 0;
            word-break: break-all;
        }

        [data-theme="dark"] .command-code,
        :root:not([data-theme]) .command-code {
            background: var(--bg-muted);
            color: var(--text-secondary);
        }

        .command-description {
            color: var(--color-gray-500);
            font-size: var(--text-sm);
            line-height: 1.5;
            margin-bottom: var(--space-3);
        }

        .command-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: var(--text-xs);
            color: var(--color-gray-400);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-overlay);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--color-white);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            width: 90%;
            max-width: var(--modal-max-width-sm);
            max-height: var(--vh-80);
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-5);
        }

        .modal-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
        }

        .close-button {
            background: none;
            border: none;
            font-size: var(--text-2xl);
            cursor: pointer;
            color: var(--color-gray-400);
        }

        .form-group {
            margin-bottom: var(--space-4);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-1_5);
            font-weight: var(--font-medium);
            color: var(--color-gray-700);
        }

        .form-input {
            width: 100%;
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            outline: none;
            transition: border-color var(--transition-normal);
        }

        .form-input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-primary-shadow);
        }

        .form-textarea {
            resize: vertical;
            min-height: calc(var(--space-16) * 1.25);
        }

        .form-actions {
            display: flex;
            gap: var(--space-3);
            justify-content: flex-end;
            margin-top: var(--space-6);
        }

        .button {
            padding: var(--space-2) var(--space-5);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--transition-normal);
            transform: translateY(0);
            position: relative;
            overflow: hidden;
        }

        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0) 100%);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .button:hover::before {
            opacity: 1;
        }

        .button:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(59, 130, 246, 0.2);
        }

        .button.secondary {
            background: var(--color-white);
            color: var(--color-gray-700);
        }

        .button.secondary:hover {
            background: var(--color-gray-100);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .button.primary {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .button.primary:hover {
            background: var(--color-primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
        }

        .button.primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .button.primary:hover {
            background: var(--color-primary-hover);
        }

        .toast {
            position: fixed;
            top: var(--space-5);
            right: var(--space-5);
            background: var(--color-white);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-modal);
            transform: translateX(100%);
            transition: transform var(--transition-slow);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid var(--color-success);
        }

        .toast.error {
            border-left: 4px solid var(--color-error);
        }

        .empty-state {
            text-align: center;
            padding: var(--space-15) var(--space-5);
            color: var(--color-gray-400);
        }

        .empty-icon {
            font-size: var(--text-4xl);
            margin-bottom: var(--space-4);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-10);
        }

        .spinner {
            width: var(--size-8);
            height: var(--size-8);
            border: 3px solid var(--color-gray-100);
            border-top: 3px solid var(--color-primary);
            border-radius: 50%;
            animation: spin var(--transition-normal) linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .color-option {
            width: var(--size-8);
            height: var(--size-8);
            border-radius: var(--radius-md);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--transition-fast);
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: var(--color-gray-700);
            transform: scale(1.1);
        }

        /* è§†è§‰ä¼˜åŒ– - åŠ¨ç”»å…³é”®å¸§ */
        @keyframes cardEntrance {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes cardHover {
            0% {
                transform: translateY(0) scale(1);
            }
            100% {
                transform: translateY(-6px) scale(1.03);
            }
        }

        @keyframes buttonPulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1.15);
            }
        }

        @keyframes appEntrance {
            0% {
                opacity: 0;
                transform: scale(0.98);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <img src="../assets/icon.png" alt="Logo" style="width: var(--size-8); height: var(--size-8); border-radius: var(--radius-md);">
                    </div>
                    <div>
                        <div style="font-weight: var(--font-semibold); font-size: var(--text-base);">å‘½ä»¤ç®¡ç†</div>
                        <div style="font-size: var(--text-xs); color: var(--color-gray-500);">å¿«é€Ÿå‘½ä»¤å·¥å…·</div>
                    </div>
                </div>

                <div class="search-box">
                    <input type="text" class="search-input" placeholder="æœç´¢å‘½ä»¤..." id="searchInput">
                    <div class="search-icon">ğŸ”</div>
                </div>
            </div>

            <div class="categories" id="categoriesList">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>

            <!-- ç»Ÿè®¡é¢æ¿ -->
            <div style="padding: var(--space-5); border-top: 1px solid var(--border-primary); background: var(--color-gray-50);">
                <div style="font-size: var(--text-xs); color: var(--color-gray-500); margin-bottom: var(--space-2);">ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</div>
                <div id="statsPanel" style="font-size: var(--text-xs); color: var(--color-gray-400); line-height: 1.4;">
                    <div>æ€»å‘½ä»¤: <span id="totalCommands">0</span></div>
                    <div>æ”¶è—: <span id="favoriteCommands">0</span></div>
                    <div>ä»Šæ—¥ä½¿ç”¨: <span id="todayUsage">0</span></div>
                </div>
            </div>

            <!-- ä½¿ç”¨æŒ‡å—æŒ‰é’® -->
            <div style="padding: var(--space-4) var(--space-5); border-top: 1px solid var(--border-primary); background: var(--color-gray-50);">
                <button onclick="showHelpModal()" style="
                    width: 100%;
                    padding: var(--space-2);
                    background: var(--color-gray-100);
                    border: 1px solid var(--border-secondary);
                    border-radius: var(--radius-md);
                    color: var(--color-gray-700);
                    font-size: var(--text-xs);
                    cursor: pointer;
                    transition: all var(--transition-normal);
                    margin-bottom: var(--space-2);
                ">
                    ğŸ“– ä½¿ç”¨æŒ‡å—
                </button>
                <button onclick="showChangelogModal()" style="
                    width: 100%;
                    padding: var(--space-2);
                    background: var(--color-gray-100);
                    border: 1px solid var(--border-secondary);
                    border-radius: var(--radius-md);
                    color: var(--color-gray-700);
                    font-size: var(--text-xs);
                    cursor: pointer;
                    transition: all var(--transition-normal);
                ">
                    ğŸ“‹ æ›´æ–°æ—¥å¿—
                </button>
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <div class="header">
                <h1 class="header-title">å‘½ä»¤åˆ—è¡¨</h1>
                <div style="display: flex; gap: var(--space-3);">
                    <button class="add-button" style="background: var(--color-success);" onclick="exportData()" title="å¯¼å‡ºæ•°æ®">ğŸ“¤ å¯¼å‡º</button>
                    <button class="add-button" style="background: var(--color-warning);" onclick="document.getElementById('importFile').click()" title="å¯¼å…¥æ•°æ®">ğŸ“¥ å¯¼å…¥</button>
                    <button class="add-button" onclick="showAddModal()">+ æ–°å»ºå‘½ä»¤</button>
                </div>
            </div>

            <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">

            <div class="commands-container" id="commandsList">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä½¿ç”¨æŒ‡å—æ¨¡æ€æ¡† -->
    <div class="modal" id="helpModal">
        <div class="modal-content" style="max-width: var(--modal-max-width);">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“– ä½¿ç”¨æŒ‡å—</h2>
                <button class="close-button" onclick="hideHelpModal()">&times;</button>
            </div>

            <div style="padding: 0 var(--space-5) var(--space-5); max-height: var(--vh-60); overflow-y: auto;">
                <h3 style="margin-bottom: var(--space-4); color: var(--color-gray-900);">å¿«é€Ÿå¼€å§‹</h3>
                
                <div style="margin-bottom: var(--space-6);">
                    <h4 style="margin-bottom: var(--space-2); color: var(--color-gray-700);">ğŸ¯ æ ¸å¿ƒåŠŸèƒ½</h4>
                    <ul style="color: var(--color-gray-500); line-height: 1.6; margin-left: var(--space-4);">
                        <li><strong>æ–°å»ºå‘½ä»¤</strong> - ç‚¹å‡»å³ä¸Šè§’"+ æ–°å»ºå‘½ä»¤"æŒ‰é’®</li>
                        <li><strong>æœç´¢å‘½ä»¤</strong> - ä½¿ç”¨æœç´¢æ¡†æˆ–å¿«æ·é”® Cmd/Ctrl + F</li>
                        <li><strong>å¤åˆ¶å‘½ä»¤</strong> - ç‚¹å‡»å‘½ä»¤å¡ç‰‡ä¸Šçš„"å¤åˆ¶"æŒ‰é’®</li>
                        <li><strong>æ”¶è—å‘½ä»¤</strong> - ç‚¹å‡»â¤ï¸å›¾æ ‡æ·»åŠ åˆ°æ”¶è—</li>
                    </ul>
                </div>

                <div style="margin-bottom: var(--space-6);">
                    <h4 style="margin-bottom: var(--space-2); color: var(--color-gray-700);">âŒ¨ï¸ å¿«æ·é”®</h4>
                    <ul style="color: var(--color-gray-500); line-height: 1.6; margin-left: var(--space-4);">
                        <li><strong>Cmd/Ctrl + N</strong> - æ–°å»ºå‘½ä»¤</li>
                        <li><strong>Cmd/Ctrl + F</strong> - èšç„¦æœç´¢æ¡†</li>
                        <li><strong>Esc</strong> - å…³é—­æ¨¡æ€æ¡†</li>
                        <li><strong>Cmd/Ctrl + 1-5</strong> - å¿«é€Ÿåˆ‡æ¢åˆ†ç±»</li>
                    </ul>
                </div>

                <div style="margin-bottom: var(--space-6);">
                    <h4 style="margin-bottom: var(--space-2); color: var(--color-gray-700);">ğŸ“Š åˆ†ç±»ç®¡ç†</h4>
                    <ul style="color: var(--color-gray-500); line-height: 1.6; margin-left: var(--space-4);">
                        <li>åœ¨ä¾§è¾¹æ åº•éƒ¨ç‚¹å‡»"æ–°å»ºåˆ†ç±»"</li>
                        <li>ä¸ºåˆ†ç±»é€‰æ‹©é¢œè‰²ä»¥ä¾¿åŒºåˆ†</li>
                        <li>ä½¿ç”¨åˆ†ç±»ç­›é€‰å‘½ä»¤</li>
                    </ul>
                </div>

                <div style="margin-bottom: var(--space-6);">
                    <h4 style="margin-bottom: var(--space-2); color: var(--color-gray-700);">ğŸ“ æ•°æ®ç®¡ç†</h4>
                    <ul style="color: var(--color-gray-500); line-height: 1.6; margin-left: var(--space-4);">
                        <li><strong>å¯¼å‡ºæ•°æ®</strong> - å¤‡ä»½æ‰€æœ‰å‘½ä»¤å’Œåˆ†ç±»</li>
                        <li><strong>å¯¼å…¥æ•°æ®</strong> - ä»JSONæ–‡ä»¶æ¢å¤æ•°æ®</li>
                        <li>æ•°æ®è‡ªåŠ¨ä¿å­˜åœ¨æœ¬åœ°æ•°æ®åº“ä¸­</li>
                    </ul>
                </div>

                <div style="background: var(--color-gray-100); padding: var(--space-4); border-radius: var(--radius-md); border-left: 4px solid var(--color-primary);">
                    <h4 style="margin-bottom: var(--space-2); color: var(--color-gray-900);">ğŸ’¡ å°è´´å£«</h4>
                    <p style="color: var(--color-gray-500); line-height: 1.6; margin: 0;">
                        ä½¿ç”¨æè¿°å’Œæ ‡ç­¾è®©å‘½ä»¤æ›´å®¹æ˜“æ‰¾åˆ°ã€‚å®šæœŸå¯¼å‡ºæ•°æ®ä»¥é˜²æ„å¤–ä¸¢å¤±ã€‚
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ åˆ†ç±»æ¨¡æ€æ¡† -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">æ–°å»ºåˆ†ç±»</h2>
                <button class="close-button" onclick="hideCategoryModal()">&times;</button>
            </div>

            <form id="categoryForm">
                <div class="form-group">
                    <label class="form-label">åˆ†ç±»åç§° *</label>
                    <input type="text" class="form-input" id="categoryName" required>
                </div>

                <div class="form-group">
                    <label class="form-label">åˆ†ç±»æè¿°</label>
                    <textarea class="form-input form-textarea" id="categoryDescription"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">åˆ†ç±»é¢œè‰²</label>
                    <div style="display: flex; gap: var(--space-2); flex-wrap: wrap; margin-top: var(--space-2);">
                        <div class="color-option" data-color="var(--color-primary)" style="background: var(--color-primary);"></div>
                        <div class="color-option" data-color="var(--color-error)" style="background: var(--color-error);"></div>
                        <div class="color-option" data-color="var(--color-success)" style="background: var(--color-success);"></div>
                        <div class="color-option" data-color="var(--color-warning)" style="background: var(--color-warning);"></div>
                        <div class="color-option" data-color="var(--color-purple)" style="background: var(--color-purple);"></div>
                        <div class="color-option" data-color="var(--color-pink)" style="background: var(--color-pink);"></div>
                        <div class="color-option" data-color="var(--color-cyan)" style="background: var(--color-cyan);"></div>
                        <div class="color-option" data-color="var(--color-lime)" style="background: var(--color-lime);"></div>
                    </div>
                    <input type="hidden" id="categoryColor" value="var(--color-primary)">
                </div>

                <div class="form-actions">
                    <button type="button" class="button secondary" onclick="hideCategoryModal()">å–æ¶ˆ</button>
                    <button type="submit" class="button primary">åˆ›å»ºåˆ†ç±»</button>
                </div>
            </form>
        </div>
    </div>

    <!-- æ›´æ–°æ—¥å¿—æ¨¡æ€æ¡† -->
    <div class="modal" id="changelogModal">
        <div class="modal-content" style="max-width: var(--size-xxl); max-height: var(--vh-80);">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“‹ ç³»ç»Ÿæ›´æ–°æ—¥å¿—</h2>
                <button class="close-button" onclick="hideChangelogModal()">&times;</button>
            </div>

            <div style="padding: 0 var(--space-5) var(--space-5); max-height: var(--vh-60); overflow-y: auto;">
                <div id="changelogContent" style="font-family: var(--font-family-mono); font-size: var(--text-sm); line-height: 1.5; color: var(--color-gray-700);">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <div class="form-actions" style="justify-content: center; margin-top: var(--space-4);">
                <button class="button secondary" onclick="hideChangelogModal()">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘å‘½ä»¤æ¨¡æ€æ¡† -->
    <div class="modal" id="commandModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">æ–°å»ºå‘½ä»¤</h2>
                <button class="close-button" onclick="hideModal()">&times;</button>
            </div>

            <form id="commandForm">
                <div class="form-group">
                    <label class="form-label">å‘½ä»¤åç§° *</label>
                    <input type="text" class="form-input" id="commandName" required>
                </div>

                <div class="form-group">
                    <label class="form-label">å‘½ä»¤å†…å®¹ *</label>
                    <textarea class="form-input form-textarea" id="commandCode" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">æè¿°</label>
                    <textarea class="form-input form-textarea" id="commandDescription"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">åˆ†ç±»</label>
                    <select class="form-input" id="commandCategory">
                        <option value="">é€‰æ‹©åˆ†ç±»</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">æ ‡ç­¾</label>
                    <input type="text" class="form-input" id="commandTags" placeholder="ç”¨é€—å·åˆ†éš”å¤šä¸ªæ ‡ç­¾">
                </div>

                <div class="form-actions">
                    <button type="button" class="button secondary" onclick="hideModal()">å–æ¶ˆ</button>
                    <button type="submit" class="button primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let commands = [];
        let categories = [];
        let currentCategory = null;
        let searchTerm = '';
        let editingCommand = null;
        let showFavorites = false;
        let showRecent = false;

        // API åŸºç¡€URL - è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ
const API_BASE = (() => {
  // å¦‚æœæ˜¯Electronç¯å¢ƒï¼Œä½¿ç”¨localhost:9091
  if (typeof window !== 'undefined' && window.electronAPI) {
    return 'http://localhost:9091/api';
  }
  // å¦‚æœæ˜¯Webç¯å¢ƒï¼Œä½¿ç”¨å½“å‰åŸŸåï¼ˆå¼€å‘ç¯å¢ƒä½¿ç”¨localhost:9091ï¼‰
  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
    return 'http://localhost:9091/api';
  }
  return `${window.location.origin}/api`;
})();

        // åˆå§‹åŒ–åº”ç”¨
        async function init() {
            await loadCategories();
            await loadCommands();
        }

        // åŠ è½½åˆ†ç±»
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories`);
                const data = await response.json();
                if (data.success) {
                    categories = data.data;
                    renderCategories();
                    updateCategorySelect();
                }
            } catch (error) {
                showToast('åŠ è½½åˆ†ç±»å¤±è´¥', 'error');
            }
        }

        // åŠ è½½å‘½ä»¤
        async function loadCommands() {
            try {
                let url = `${API_BASE}/commands`;
                const params = new URLSearchParams();

                if (currentCategory) {
                    params.append('category_id', currentCategory);
                }
                if (searchTerm) {
                    params.append('search', searchTerm);
                }
                if (showFavorites) {
                    params.append('favorite', 'true');
                }

                if (params.toString()) {
                    url += '?' + params.toString();
                }

                const response = await fetch(url);
                const data = await response.json();
                if (data.success) {
                    commands = data.data;

                    // å¦‚æœæ˜¯æœ€è¿‘å¸¸ç”¨è¿‡æ»¤ï¼Œä½¿ç”¨æœ¬åœ°è¿‡æ»¤
                    if (showRecent) {
                        commands = getRecentCommands();
                    }

                    renderCommands();
                }
            } catch (error) {
                showToast('åŠ è½½å‘½ä»¤å¤±è´¥', 'error');
            }
        }

        // æ¸²æŸ“åˆ†ç±»åˆ—è¡¨
        function renderCategories() {
            const container = document.getElementById('categoriesList');

            let html = `
                <div class="category-item ${!currentCategory && !showFavorites && !showRecent ? 'active' : ''}" onclick="selectCategory(null)">
                    <div class="category-color" style="background: var(--color-gray-500);"></div>
                    <span>å…¨éƒ¨å‘½ä»¤</span>
                    <span class="category-count">${commands.length}</span>
                </div>
                <div class="category-item ${showRecent ? 'active' : ''}" onclick="toggleRecentFilter()">
                    <div class="category-color" style="background: var(--color-primary);">ğŸ•’</div>
                    <span>æœ€è¿‘å¸¸ç”¨</span>
                    <span class="category-count">${getRecentCommands().length}</span>
                </div>
                <div class="category-item ${showFavorites ? 'active' : ''}" onclick="toggleFavoriteFilter()">
                    <div class="category-color" style="background: var(--color-error);">â¤ï¸</div>
                    <span>æ”¶è—çš„å‘½ä»¤</span>
                    <span class="category-count">${commands.filter(cmd => cmd.is_favorite).length}</span>
                </div>
            `;

            categories.forEach(category => {
                html += `
                    <div class="category-item ${currentCategory === category.id ? 'active' : ''}" onclick="selectCategory(${category.id})">
                        <div class="category-color" style="background: ${category.color};"></div>
                        <span>${category.name}</span>
                        <span class="category-count">${category.command_count}</span>
                    </div>
                `;
            });

            // æ·»åŠ åˆ›å»ºåˆ†ç±»æŒ‰é’®
            html += `
                <div class="category-item" onclick="showAddCategoryModal()" style="border: 1px dashed var(--border-secondary); margin-top: var(--space-2);">
                    <div class="category-color" style="background: var(--color-gray-100); display: flex; align-items: center; justify-content: center; color: var(--color-gray-400);">+</div>
                    <span style="color: var(--color-gray-500);">æ–°å»ºåˆ†ç±»</span>
                </div>
            `;

            container.innerHTML = html;
        }

        // æ¸²æŸ“å‘½ä»¤åˆ—è¡¨
        function renderCommands() {
            const container = document.getElementById('commandsList');

            if (commands.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“</div>
                        <h3>è¿˜æ²¡æœ‰å‘½ä»¤</h3>
                        <p>ç‚¹å‡»"æ–°å»ºå‘½ä»¤"æŒ‰é’®åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªå‘½ä»¤</p>
                    </div>
                `;
                return;
            }

            let html = '';
            commands.forEach(command => {
                html += `
                    <div class="command-card">
                        <div class="command-header">
                            <div>
                                <div class="command-name">${command.name}</div>
                                ${command.category_name ? `
                                    <div class="command-category">
                                        <div class="category-color" style="background: ${command.category_color};"></div>
                                        ${command.category_name}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="command-actions">
                                <button class="action-button ${command.is_favorite ? 'favorite' : ''}" onclick="toggleFavorite(${command.id})" title="${command.is_favorite ? 'å–æ¶ˆæ”¶è—' : 'æ·»åŠ æ”¶è—'}">
                                    ${command.is_favorite ? 'â¤ï¸' : 'ğŸ¤'}
                                </button>
                                <button class="action-button primary" onclick="copyCommand('${command.command.replace(/'/g, "\\'")}', ${command.id})">å¤åˆ¶</button>
                                <button class="action-button" onclick="editCommand(${command.id})">ç¼–è¾‘</button>
                                <button class="action-button" onclick="deleteCommand(${command.id})">åˆ é™¤</button>
                            </div>
                        </div>

                        <div class="command-code">${command.command}</div>

                        ${command.description ? `<div class="command-description">${command.description}</div>` : ''}

                        <div class="command-meta">
                            <span>ä½¿ç”¨ ${command.usage_count} æ¬¡</span>
                            <span>æœ€åä½¿ç”¨: ${command.last_used ? new Date(command.last_used).toLocaleString() : 'ä»æœªä½¿ç”¨'}</span>
                            <span>åˆ›å»ºäº: ${new Date(command.created_at).toLocaleDateString()}</span>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            updateStats();
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const totalCommands = commands.length;
            const favoriteCommands = commands.filter(cmd => cmd.is_favorite).length;
            const today = new Date().toDateString();
            const todayUsage = commands.reduce((total, cmd) => {
                const lastUsed = cmd.last_used ? new Date(cmd.last_used).toDateString() : null;
                return total + (lastUsed === today ? 1 : 0);
            }, 0);

            document.getElementById('totalCommands').textContent = totalCommands;
            document.getElementById('favoriteCommands').textContent = favoriteCommands;
            document.getElementById('todayUsage').textContent = todayUsage;
        }

        // æ›´æ–°åˆ†ç±»é€‰æ‹©æ¡†
        function updateCategorySelect() {
            const select = document.getElementById('commandCategory');
            let html = '<option value="">é€‰æ‹©åˆ†ç±»</option>';

            categories.forEach(category => {
                html += `<option value="${category.id}">${category.name}</option>`;
            });

            select.innerHTML = html;
        }

        // é€‰æ‹©åˆ†ç±»
        function selectCategory(categoryId) {
            currentCategory = categoryId;
            showFavorites = false;
            showRecent = false;
            loadCommands();
            renderCategories();
        }

        // åˆ‡æ¢æ”¶è—è¿‡æ»¤
        function toggleFavoriteFilter() {
            showFavorites = !showFavorites;
            showRecent = false;
            currentCategory = null;
            loadCommands();
            renderCategories();
        }

        // åˆ‡æ¢æœ€è¿‘å¸¸ç”¨è¿‡æ»¤
        function toggleRecentFilter() {
            showRecent = !showRecent;
            showFavorites = false;
            currentCategory = null;
            loadCommands();
            renderCategories();
        }

        // è·å–æœ€è¿‘å¸¸ç”¨å‘½ä»¤ï¼ˆæŒ‰ä½¿ç”¨æ¬¡æ•°å’Œæœ€åä½¿ç”¨æ—¶é—´æ’åºï¼‰
        function getRecentCommands() {
            const now = new Date();
            const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);

            return commands
                .filter(cmd => cmd.usage_count > 0) // è‡³å°‘ä½¿ç”¨è¿‡ä¸€æ¬¡
                .sort((a, b) => {
                    // ä¼˜å…ˆæŒ‰ä½¿ç”¨æ¬¡æ•°æ’åºï¼Œç„¶åæŒ‰æœ€åä½¿ç”¨æ—¶é—´
                    if (b.usage_count !== a.usage_count) {
                        return b.usage_count - a.usage_count;
                    }
                    const aTime = a.last_used ? new Date(a.last_used) : new Date(a.updated_at);
                    const bTime = b.last_used ? new Date(b.last_used) : new Date(b.updated_at);
                    return bTime - aTime;
                })
                .slice(0, 10); // åªæ˜¾ç¤ºå‰10ä¸ª
        }

        // åˆ‡æ¢æ”¶è—çŠ¶æ€
        async function toggleFavorite(commandId) {
            try {
                const command = commands.find(c => c.id === commandId);
                if (!command) return;

                const response = await fetch(`${API_BASE}/commands/${commandId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ is_favorite: !command.is_favorite })
                });

                const data = await response.json();

                if (data.success) {
                    showToast(command.is_favorite ? 'å·²å–æ¶ˆæ”¶è—' : 'å·²æ·»åŠ åˆ°æ”¶è—', 'success');
                    loadCommands();
                    loadCategories();
                } else {
                    showToast('æ“ä½œå¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('æ“ä½œå¤±è´¥', 'error');
            }
        }

        // æœç´¢å‘½ä»¤
        function searchCommands() {
            searchTerm = document.getElementById('searchInput').value;
            loadCommands();
        }

        // å¤åˆ¶å‘½ä»¤
        async function copyCommand(command, commandId) {
            try {
                await navigator.clipboard.writeText(command);
                showToast('å‘½ä»¤å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');

                // å¢åŠ ä½¿ç”¨æ¬¡æ•°
                await fetch(`${API_BASE}/commands/${commandId}/use`, { method: 'POST' });
                loadCommands();
            } catch (error) {
                showToast('å¤åˆ¶å¤±è´¥', 'error');
            }
        }

        // æ˜¾ç¤ºæ·»åŠ åˆ†ç±»æ¨¡æ€æ¡†
        function showAddCategoryModal() {
            document.getElementById('categoryForm').reset();
            document.getElementById('categoryColor').value = 'var(--color-primary)';
            // é‡ç½®é¢œè‰²é€‰æ‹©
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector('.color-option[data-color="var(--color-primary)"]').classList.add('selected');
            document.getElementById('categoryModal').classList.add('show');
        }

        // éšè—åˆ†ç±»æ¨¡æ€æ¡†
        function hideCategoryModal() {
            document.getElementById('categoryModal').classList.remove('show');
        }

        // æ˜¾ç¤ºå¸®åŠ©æ¨¡æ€æ¡†
        function showHelpModal() {
            document.getElementById('helpModal').classList.add('show');
        }

        // éšè—å¸®åŠ©æ¨¡æ€æ¡†
        function hideHelpModal() {
            document.getElementById('helpModal').classList.remove('show');
        }

        // æ˜¾ç¤ºæ·»åŠ æ¨¡æ€æ¡†
        function showAddModal() {
            editingCommand = null;
            document.getElementById('modalTitle').textContent = 'æ–°å»ºå‘½ä»¤';
            document.getElementById('commandForm').reset();
            document.getElementById('commandModal').classList.add('show');
        }

        // ç¼–è¾‘å‘½ä»¤
        function editCommand(commandId) {
            const command = commands.find(c => c.id === commandId);
            if (!command) return;

            editingCommand = command;
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘å‘½ä»¤';
            document.getElementById('commandName').value = command.name;
            document.getElementById('commandCode').value = command.command;
            document.getElementById('commandDescription').value = command.description || '';
            document.getElementById('commandCategory').value = command.category_id || '';
            document.getElementById('commandTags').value = command.tags || '';
            document.getElementById('commandModal').classList.add('show');
        }

        // åˆ é™¤å‘½ä»¤
        async function deleteCommand(commandId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå‘½ä»¤å—ï¼Ÿ')) return;

            try {
                const response = await fetch(`${API_BASE}/commands/${commandId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();

                if (data.success) {
                    showToast('å‘½ä»¤åˆ é™¤æˆåŠŸ', 'success');
                    loadCommands();
                    loadCategories();
                } else {
                    showToast('åˆ é™¤å¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('åˆ é™¤å¤±è´¥', 'error');
            }
        }

        // éšè—æ¨¡æ€æ¡†
        function hideModal() {
            document.getElementById('commandModal').classList.remove('show');
        }

        // æ˜¾ç¤ºæ›´æ–°æ—¥å¿—æ¨¡æ€æ¡†
        async function showChangelogModal() {
            const modal = document.getElementById('changelogModal');
            const content = document.getElementById('changelogContent');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            modal.classList.add('show');
            
            try {
                // é€šè¿‡Electron APIè·å–æ›´æ–°æ—¥å¿—
                const changelog = await window.electronAPI.getChangelog();
                
                if (changelog) {
                    // æ ¼å¼åŒ–æ˜¾ç¤ºæ›´æ–°æ—¥å¿—
                    let html = `<div style="margin-bottom: var(--space-5);">
                        <div style="font-size: var(--text-base); font-weight: 600; color: var(--color-gray-900); margin-bottom: var(--space-2);">
                            ğŸ“¦ ç‰ˆæœ¬ v${changelog.version}
                        </div>
                        <div style="background: var(--color-gray-100); padding: var(--space-4); border-radius: var(--radius-md); border-left: 4px solid var(--color-primary);">
                            <div style="font-weight: 600; margin-bottom: var(--space-2); color: var(--color-gray-700);">âœ¨ ä¸»è¦æ›´æ–°ï¼š</div>
                            <div style="white-space: pre-wrap; color: var(--color-gray-500); line-height: 1.6;">${changelog.features}</div>
                        </div>
                    </div>`;
                    
                    // æ·»åŠ å®Œæ•´æ—¥å¿—é“¾æ¥
                    html += `<div style="text-align: center; margin-top: var(--space-5); padding-top: var(--space-4); border-top: 1px solid var(--border-primary);">
                        <div style="font-size: var(--text-xs); color: var(--color-gray-400); margin-bottom: var(--space-2);">
                            æŸ¥çœ‹å®Œæ•´æ›´æ–°æ—¥å¿—è¯·æŸ¥çœ‹ CHANGELOG.md æ–‡ä»¶
                        </div>
                    </div>`;
                    
                    content.innerHTML = html;
                } else {
                    content.innerHTML = '<div style="text-align: center; color: var(--color-gray-400); padding: var(--space-10);">' +
                    '<div style="font-size: var(--text-4xl); margin-bottom: var(--space-4);">ğŸ“„</div>' +
                    '<div>æ›´æ–°æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ ¼å¼ä¸æ­£ç¡®</div>' +
                '</div>';
                }
            } catch (error) {
                console.error('åŠ è½½æ›´æ–°æ—¥å¿—å¤±è´¥:', error);
                content.innerHTML = '<div style="text-align: center; color: var(--color-error); padding: var(--space-10);">' +
                    '<div style="font-size: var(--text-4xl); margin-bottom: var(--space-4);">âŒ</div>' +
                    '<div>åŠ è½½æ›´æ–°æ—¥å¿—å¤±è´¥</div>' +
                '</div>';
            }
        }

        // éšè—æ›´æ–°æ—¥å¿—æ¨¡æ€æ¡†
        function hideChangelogModal() {
            document.getElementById('changelogModal').classList.remove('show');
        }

        // ä¿å­˜å‘½ä»¤
        async function saveCommand(event) {
            event.preventDefault();

            const formData = {
                name: document.getElementById('commandName').value,
                command: document.getElementById('commandCode').value,
                description: document.getElementById('commandDescription').value,
                category_id: document.getElementById('commandCategory').value || null,
                tags: document.getElementById('commandTags').value
            };

            try {
                let response;
                if (editingCommand) {
                    response = await fetch(`${API_BASE}/commands/${editingCommand.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                } else {
                    response = await fetch(`${API_BASE}/commands`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                }

                const data = await response.json();

                if (data.success) {
                    showToast(editingCommand ? 'å‘½ä»¤æ›´æ–°æˆåŠŸ' : 'å‘½ä»¤åˆ›å»ºæˆåŠŸ', 'success');
                    hideModal();
                    loadCommands();
                    loadCategories();
                } else {
                    showToast('ä¿å­˜å¤±è´¥', 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥', 'error');
            }
        }

        // å¯¼å‡ºæ•°æ®
        async function exportData() {
            try {
                const [commandsData, categoriesData] = await Promise.all([
                    fetch(`${API_BASE}/commands`).then(r => r.json()),
                    fetch(`${API_BASE}/categories`).then(r => r.json())
                ]);

                const exportData = {
                    commands: commandsData.data || [],
                    categories: categoriesData.data || [],
                    exportDate: new Date().toISOString(),
                    version: '1.0.0'
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `commands-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showToast('æ•°æ®å¯¼å‡ºæˆåŠŸ', 'success');
            } catch (error) {
                showToast('å¯¼å‡ºå¤±è´¥', 'error');
            }
        }

        // å¯¼å…¥æ•°æ®
        async function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                const data = JSON.parse(text);

                if (!data.commands || !data.categories) {
                    showToast('æ— æ•ˆçš„æ•°æ®æ ¼å¼', 'error');
                    return;
                }

                let importedCommands = 0;
                let importedCategories = 0;

                // å¯¼å…¥åˆ†ç±»
                for (const category of data.categories) {
                    try {
                        await fetch(`${API_BASE}/categories`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                name: category.name,
                                description: category.description,
                                color: category.color
                            })
                        });
                        importedCategories++;
                    } catch (error) {
                        console.warn('å¯¼å…¥åˆ†ç±»å¤±è´¥:', category.name);
                    }
                }

                // å¯¼å…¥å‘½ä»¤
                for (const command of data.commands) {
                    try {
                        await fetch(`${API_BASE}/commands`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                name: command.name,
                                command: command.command,
                                description: command.description,
                                category_id: command.category_id,
                                tags: command.tags,
                                is_favorite: command.is_favorite || false
                            })
                        });
                        importedCommands++;
                    } catch (error) {
                        console.warn('å¯¼å…¥å‘½ä»¤å¤±è´¥:', command.name);
                    }
                }

                showToast(`å¯¼å…¥æˆåŠŸï¼š${importedCommands} ä¸ªå‘½ä»¤ï¼Œ${importedCategories} ä¸ªåˆ†ç±»`, 'success');
                loadCommands();
                loadCategories();
            } catch (error) {
                showToast('å¯¼å…¥å¤±è´¥ï¼š' + error.message, 'error');
            }

            // é‡ç½®æ–‡ä»¶è¾“å…¥
            event.target.value = '';
        }

        // æ˜¾ç¤ºæç¤º
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type} show`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(event) {
            // Cmd/Ctrl + N: æ–°å»ºå‘½ä»¤
            if ((event.metaKey || event.ctrlKey) && event.key === 'n') {
                event.preventDefault();
                showAddModal();
            }

            // Cmd/Ctrl + F: èšç„¦æœç´¢æ¡†
            if ((event.metaKey || event.ctrlKey) && event.key === 'f') {
                event.preventDefault();
                document.getElementById('searchInput').focus();
            }

            // Escape: å…³é—­æ¨¡æ€æ¡†
            if (event.key === 'Escape') {
                hideModal();
            }

            // Cmd/Ctrl + 1-5: å¿«é€Ÿåˆ‡æ¢åˆ†ç±»
            if ((event.metaKey || event.ctrlKey) && event.key >= '1' && event.key <= '5') {
                event.preventDefault();
                const categoryIndex = parseInt(event.key) - 1;
                if (categoryIndex === 0) {
                    selectCategory(null);
                } else if (categories[categoryIndex - 1]) {
                    selectCategory(categories[categoryIndex - 1].id);
                }
            }
        });

        // ä¿å­˜åˆ†ç±»
        async function saveCategory(event) {
            event.preventDefault();

            const formData = {
                name: document.getElementById('categoryName').value,
                description: document.getElementById('categoryDescription').value,
                color: document.getElementById('categoryColor').value
            };

            try {
                const response = await fetch(`${API_BASE}/categories`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success) {
                    showToast('åˆ†ç±»åˆ›å»ºæˆåŠŸ', 'success');
                    hideCategoryModal();
                    loadCategories();
                } else {
                    showToast('åˆ›å»ºå¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            } catch (error) {
                showToast('åˆ›å»ºå¤±è´¥', 'error');
            }
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('searchInput').addEventListener('input', searchCommands);
        document.getElementById('commandForm').addEventListener('submit', saveCommand);
        document.getElementById('categoryForm').addEventListener('submit', saveCategory);

        // é¢œè‰²é€‰æ‹©å™¨äº‹ä»¶
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('color-option')) {
                // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.remove('selected');
                });
                // æ·»åŠ é€‰ä¸­çŠ¶æ€
                event.target.classList.add('selected');
                // è®¾ç½®é¢œè‰²å€¼
                document.getElementById('categoryColor').value = event.target.dataset.color;
            }
        });

        // ä¸»é¢˜ç®¡ç†å™¨
        class ThemeManager {
            constructor() {
                this.currentTheme = this.getStoredTheme() || this.getSystemTheme();
                this.applyTheme(this.currentTheme);
                this.setupSystemThemeListener();
            }

            getStoredTheme() {
                try {
                    return localStorage.getItem('theme');
                } catch (error) {
                    console.warn('æ— æ³•è®¿é—®localStorage:', error);
                    return null;
                }
            }

            getSystemTheme() {
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }

            applyTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                this.currentTheme = theme;
                this.dispatchThemeChangeEvent(theme);
            }

            toggleTheme() {
                const newTheme = this.currentTheme === 'dark' ? 'light' : 'dark';
                this.applyTheme(newTheme);
                this.storeTheme(newTheme);
            }

            storeTheme(theme) {
                try {
                    localStorage.setItem('theme', theme);
                } catch (error) {
                    console.warn('æ— æ³•å­˜å‚¨ä¸»é¢˜åˆ°localStorage:', error);
                }
            }

            setupSystemThemeListener() {
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                mediaQuery.addEventListener('change', (e) => {
                    if (!this.hasUserOverride()) {
                        this.applyTheme(e.matches ? 'dark' : 'light');
                    }
                });
            }

            hasUserOverride() {
                return localStorage.getItem('theme') !== null;
            }

            dispatchThemeChangeEvent(theme) {
                const event = new CustomEvent('themechange', {
                    detail: { theme }
                });
                document.dispatchEvent(event);
            }

            resetToSystemTheme() {
                localStorage.removeItem('theme');
                this.applyTheme(this.getSystemTheme());
            }
        }

        // åˆå§‹åŒ–ä¸»é¢˜ç®¡ç†å™¨
        const themeManager = new ThemeManager();

        // ä¸»é¢˜åˆ‡æ¢æŒ‰é’®å¤„ç†
        function setupThemeToggle() {
            const toggleBtn = document.createElement('button');
            toggleBtn.className = 'theme-toggle';
            toggleBtn.innerHTML = `
                <span class="theme-icon">ğŸŒ™</span>
                <span class="theme-text">åˆ‡æ¢ä¸»é¢˜</span>
            `;
            
            toggleBtn.addEventListener('click', () => {
                themeManager.toggleTheme();
                updateToggleButton();
            });

            // æ·»åŠ åˆ°é¡µé¢ - åœ¨ä½¿ç”¨æŒ‡å—æŒ‰é’®ä¸Šæ–¹
            const helpButtonSection = document.querySelector('.sidebar > div:has(button[onclick="showHelpModal()"])');
            if (helpButtonSection) {
                helpButtonSection.parentNode.insertBefore(toggleBtn, helpButtonSection);
            } else {
                // å¤‡ç”¨æ–¹æ¡ˆï¼šæ·»åŠ åˆ°ä¾§è¾¹æ åº•éƒ¨
                const sidebar = document.querySelector('.sidebar');
                if (sidebar) {
                    sidebar.appendChild(toggleBtn);
                }
            }

            updateToggleButton();

            function updateToggleButton() {
                const icon = toggleBtn.querySelector('.theme-icon');
                const text = toggleBtn.querySelector('.theme-text');
                
                if (themeManager.currentTheme === 'dark') {
                    icon.textContent = 'â˜€ï¸';
                    text.textContent = 'åˆ‡æ¢åˆ°äº®è‰²';
                } else {
                    icon.textContent = 'ğŸŒ™';
                    text.textContent = 'åˆ‡æ¢åˆ°æ·±è‰²';
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè®¾ç½®ä¸»é¢˜åˆ‡æ¢
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupThemeToggle);
        } else {
            setupThemeToggle();
        }

        // åˆå§‹åŒ–åº”ç”¨
        init();
    </script>
</body>
</html>
