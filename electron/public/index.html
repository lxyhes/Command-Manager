<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>命令管理工具</title>
    <style>
    :root {
        /* 颜色系统 */
        --color-primary: #3b82f6;
        --color-primary-hover: #2563eb;
        --color-primary-active: #1d4ed8;
        --color-secondary: #6b7280;
        --color-success: #10b981;
        --color-warning: #f59e0b;
        --color-danger: #ef4444;
        --color-info: #06b6d4;
        --color-purple: #764ba2;
        --color-primary-shadow: rgba(59, 130, 246, 0.1);
        
        /* 中性色 */
        --color-white: #ffffff;
        --color-gray-50: #f9fafb;
        --color-gray-100: #f3f4f6;
        --color-gray-200: #e5e7eb;
        --color-gray-300: #d1d5db;
        --color-gray-400: #9ca3af;
        --color-gray-500: #6b7280;
        --color-gray-600: #4b5563;
        --color-gray-700: #374151;
        --color-gray-800: #1f2937;
        --color-gray-900: #111827;
        --color-black: #000000;
        
        /* 文本颜色 */
        --text-primary: var(--color-gray-900);
        --text-secondary: var(--color-gray-600);
        --text-muted: var(--color-gray-500);
        --text-inverse: var(--color-white);
        
        /* 背景颜色 */
        --bg-primary: var(--color-white);
        --bg-secondary: var(--color-gray-50);
        --bg-muted: var(--color-gray-100);
        --bg-overlay: rgba(0, 0, 0, 0.5);
        
        /* 边框颜色 */
        --border-primary: var(--color-gray-200);
        --border-secondary: var(--color-gray-300);
        --border-muted: var(--color-gray-100);
        
        /* 圆角系统 */
        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;
        --radius-xl: 16px;
        --radius-full: 9999px;
        
        /* 边框宽度 */
        --border-width-sm: 1px;
        --border-width-md: 2px;
        --border-width-lg: 3px;
        
        /* 阴影系统 */
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        
        /* 尺寸系统 */
        --size-8: 32px;
        --sidebar-width: 280px;
        --modal-max-width: 600px;
        --vh-60: 60vh;
        --vh-80: 80vh;
        --vh-100: 100vh;
        
        /* 间距系统 */
        --space-1: 4px;
        --space-2: 8px;
        --space-3: 12px;
        --space-4: 16px;
        --space-5: 20px;
        --space-6: 24px;
        --space-8: 32px;
        --space-10: 40px;
        --space-12: 48px;
        --space-16: 64px;
        
        /* 字体系统 */
        --font-family-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        --font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        
        /* 字体大小 */
        --text-xs: 12px;
        --text-sm: 14px;
        --text-base: 16px;
        --text-lg: 18px;
        --text-xl: 20px;
        --text-2xl: 24px;
        --text-3xl: 30px;
        
        /* 字体粗细 */
        --font-light: 300;
        --font-normal: 400;
        --font-medium: 500;
        --font-semibold: 600;
        --font-bold: 700;
        
        /* 过渡动画 */
        --transition-fast: 150ms ease-in-out;
        --transition-normal: 200ms ease-in-out;
        --transition-slow: 300ms ease-in-out;
        
        /* 视觉优化 - 渐变色彩 */
        --gradient-primary: linear-gradient(135deg, var(--color-primary), var(--color-primary-active));
        --gradient-card: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.98));
        --gradient-sidebar: linear-gradient(180deg, var(--color-primary), var(--color-primary-active));
        
        /* 视觉优化 - 增强阴影 */
        --shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.15);
        --shadow-focus: 0 0 0 3px rgba(59, 130, 246, 0.1);
        
        /* 视觉优化 - 缓动函数 */
        --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
        --ease-in-out-back: cubic-bezier(0.68, -0.6, 0.32, 1.6);
        
        /* 层级 */
        --z-dropdown: 1000;
        --z-sticky: 1020;
        --z-fixed: 1030;
        --z-modal-backdrop: 1040;
        --z-modal: 1050;
        --z-popover: 1060;
        --z-tooltip: 1070;
        
        /* 深色主题变量 */
        --color-scheme: light;
    }
    
    /* 深色主题 */
    [data-theme="dark"] {
        --color-scheme: dark;
        
        /* 颜色系统 - 深色主题 */
        --color-primary: #60a5fa;
        --color-primary-hover: #3b82f6;
        --color-primary-active: #2563eb;
        --color-primary-shadow: rgba(96, 165, 250, 0.2);
        
        /* 中性色 - 深色主题 */
        --color-white: #ffffff;
        --color-gray-50: #f9fafb;
        --color-gray-100: #f3f4f6;
        --color-gray-200: #e5e7eb;
        --color-gray-300: #d1d5db;
        --color-gray-400: #9ca3af;
        --color-gray-500: #6b7280;
        --color-gray-600: #4b5563;
        --color-gray-700: #374151;
        --color-gray-800: #1f2937;
        --color-gray-900: #111827;
        --color-black: #000000;
        
        /* 文本颜色 - 深色主题 */
        --text-primary: #f3f4f6;
        --text-secondary: #d1d5db;
        --text-muted: #9ca3af;
        --text-inverse: #1f2937;
        
        /* 背景颜色 - 深色主题 */
        --bg-primary: #1f2937;
        --bg-secondary: #111827;
        --bg-muted: #374151;
        --bg-overlay: rgba(0, 0, 0, 0.7);
        
        /* 边框颜色 - 深色主题 */
        --border-primary: #374151;
        --border-secondary: #4b5563;
        --border-muted: #374151;
        
        /* 阴影系统 - 深色主题 */
        --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.4);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.5);
        --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.6);
        --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.7);
        
        /* 视觉优化 - 深色主题渐变 */
        --gradient-primary-dark: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));
        --gradient-card-dark: linear-gradient(135deg, rgba(31, 41, 55, 0.95), rgba(31, 41, 55, 0.98));
        --gradient-sidebar-dark: linear-gradient(180deg, var(--color-primary), var(--color-primary-hover));
    }
    
    /* 主题切换按钮样式 */
        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 8px 16px;
            border: 2px solid var(--border-primary);
            border-radius: var(--radius-lg);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
            margin: var(--space-4) auto;
            width: fit-content;
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--color-primary);
            background: var(--color-primary);
            color: var(--color-white);
        }

        .theme-toggle:active {
            transform: translateY(0);
        }

        .theme-icon {
            font-size: 18px;
            transition: transform var(--transition-fast);
        }

        .theme-toggle:hover .theme-icon {
            transform: rotate(180deg);
        }

        .theme-text {
            white-space: nowrap;
        }

        /* 深色主题样式覆盖 */
        [data-theme="dark"] .sidebar,
        :root:not([data-theme]) .sidebar {
            background: var(--gradient-sidebar-dark);
            border-right-color: var(--border-primary);
        }

        [data-theme="dark"] .command-card,
        :root:not([data-theme]) .command-card {
            background: var(--gradient-card-dark);
            border-color: var(--border-primary);
            box-shadow: var(--shadow-sm);
        }

        [data-theme="dark"] .command-card:hover,
        :root:not([data-theme]) .command-card:hover {
            background: var(--bg-secondary);
            border-color: var(--color-primary);
            box-shadow: var(--shadow-md);
        }

        [data-theme="dark"] .search-input,
        :root:not([data-theme]) .search-input {
            background: var(--bg-muted);
            border-color: var(--border-primary);
            color: var(--text-primary);
        }

        [data-theme="dark"] .search-input:focus,
        :root:not([data-theme]) .search-input:focus {
            border-color: var(--color-primary);
            background: var(--bg-primary);
        }

        [data-theme="dark"] .category-item,
        :root:not([data-theme]) .category-item {
            color: var(--text-secondary);
        }

        [data-theme="dark"] .category-item:hover,
        :root:not([data-theme]) .category-item:hover {
            background: var(--bg-muted);
            color: var(--text-primary);
        }

        [data-theme="dark"] .category-item.active,
        :root:not([data-theme]) .category-item.active {
            background: var(--color-primary);
            color: var(--color-white);
        }

        [data-theme="dark"] .action-button,
        :root:not([data-theme]) .action-button {
            background: var(--bg-muted);
            color: var(--text-secondary);
            border-color: var(--border-primary);
        }

        [data-theme="dark"] .action-button:hover,
        :root:not([data-theme]) .action-button:hover {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        [data-theme="dark"] .modal-content,
        :root:not([data-theme]) .modal-content {
            background: var(--bg-primary);
            border-color: var(--border-primary);
        }

        [data-theme="dark"] .modal-header,
        :root:not([data-theme]) .modal-header {
            border-bottom-color: var(--border-primary);
        }

        [data-theme="dark"] .modal-footer,
        :root:not([data-theme]) .modal-footer {
            border-top-color: var(--border-primary);
        }

        [data-theme="dark"] .toast,
        :root:not([data-theme]) .toast {
            background: var(--bg-primary);
            border-color: var(--border-primary);
            color: var(--text-primary);
            box-shadow: var(--shadow-lg);
        }

        /* 深色主题下统计面板样式 */
        [data-theme="dark"] .sidebar > div:has(#statsPanel),
        :root:not([data-theme]) .sidebar > div:has(#statsPanel) {
            background: var(--color-gray-800) !important;
            border-top-color: var(--color-gray-700) !important;
        }

        [data-theme="dark"] .sidebar > div:has(#statsPanel) > div:first-child,
        :root:not([data-theme]) .sidebar > div:has(#statsPanel) > div:first-child {
            color: var(--color-gray-300) !important;
        }

        [data-theme="dark"] #statsPanel,
        :root:not([data-theme]) #statsPanel {
            color: var(--color-gray-400) !important;
        }

        /* 深色主题下使用指南按钮样式 */
        [data-theme="dark"] .sidebar > div:has(button[onclick="showHelpModal()"]),
        :root:not([data-theme]) .sidebar > div:has(button[onclick="showHelpModal()"]) {
            background: var(--color-gray-800) !important;
            border-top-color: var(--color-gray-700) !important;
        }

        [data-theme="dark"] .sidebar > div:has(button[onclick="showHelpModal()"]) button,
        :root:not([data-theme]) .sidebar > div:has(button[onclick="showHelpModal()"]) button {
            background: var(--color-gray-700) !important;
            border-color: var(--color-gray-600) !important;
            color: var(--color-gray-200) !important;
        }

        [data-theme="dark"] .sidebar > div:has(button[onclick="showHelpModal()"]) button:hover,
        :root:not([data-theme]) .sidebar > div:has(button[onclick="showHelpModal()"]) button:hover {
            background: var(--color-gray-600) !important;
            border-color: var(--color-gray-500) !important;
        }

        /* 系统主题检测 */
        @media (prefers-color-scheme: dark) {
        :root:not([data-theme]) {
            --color-scheme: dark;
            
            /* 应用深色主题变量 */
            --color-primary: #60a5fa;
            --color-primary-hover: #3b82f6;
            --color-primary-active: #2563eb;
            --color-primary-shadow: rgba(96, 165, 250, 0.2);
            
            --text-primary: #f3f4f6;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            
            --bg-primary: #1f2937;
            --bg-secondary: #111827;
            --bg-muted: #374151;
            
            --border-primary: #374151;
            --border-secondary: #4b5563;
            
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.4);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.6);
        }
    }
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

        body {
            font-family: var(--font-family-sans);
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-muted) 100%);
            color: var(--text-primary);
            height: var(--vh-100);
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        
        .app {
            display: flex;
            height: var(--vh-100);
            animation: appEntrance 0.8s var(--ease-out-back) both;

        .sidebar {
            width: var(--sidebar-width);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-lg);
        }

        .sidebar-header {
            padding: var(--space-6);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
            position: relative;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-6);
        }

        .logo-icon {
            width: var(--size-8);
            height: var(--size-8);
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-purple) 100%);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-white);
            font-weight: var(--font-bold);
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);
            transition: all var(--transition-normal);
        }

        .logo-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.4);
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: var(--space-4) var(--space-4) var(--space-4) calc(var(--space-4) + var(--space-6));
            border: 2px solid transparent;
            border-radius: var(--radius-xl);
            font-size: var(--text-sm);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all var(--transition-normal);
            color: var(--text-primary);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--color-primary);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-icon {
            position: absolute;
            left: var(--space-3);
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-gray-400);
        }

        .categories {
            flex: 1;
            padding: var(--space-5);
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
        }

        .category-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0) 100%);
            opacity: 0;
            transition: opacity var(--transition-normal);
            z-index: -1;
        }

        .category-item:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateX(4px);
        }

        .category-item:hover::before {
            opacity: 1;
        }

        .category-item.active {
            background: var(--color-primary);
            color: var(--color-white);
            font-weight: var(--font-semibold);
            transform: translateX(8px);
        }

        .category-item.active::before {
            opacity: 1;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0) 100%);
        }

        .category-color {
            width: var(--space-3);
            height: var(--space-3);
            border-radius: 50%;
        }

        .category-count {
            margin-left: auto;
            background: var(--color-gray-100);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-xl);
            font-size: var(--text-xs);
            color: var(--color-gray-500);
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            padding: var(--space-5) var(--space-6);
            border-bottom: 1px solid var(--border-primary);
            background: var(--bg-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: var(--text-2xl);
            font-weight: var(--font-semibold);
            color: var(--color-gray-900);
        }

        [data-theme="dark"] .header-title,
        :root:not([data-theme]) .header-title {
            color: var(--text-primary);
        }

        .add-button {
            background: var(--color-primary);
            color: var(--color-white);
            border: none;
            padding: var(--space-2) var(--space-5);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: background-color var(--transition-normal);
        }

        .add-button:hover {
            background: var(--color-primary-hover);
        }

        .commands-container {
            flex: 1;
            padding: var(--space-6);
            overflow-y: auto;
            background: var(--bg-secondary);
        }

        .command-card {
            background: var(--gradient-card);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-xl);
            padding: var(--space-5);
            margin-bottom: var(--space-4);
            transition: all var(--transition-normal);
            cursor: default;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
            transform-origin: center;
            animation: cardEntrance 0.6s var(--ease-out-back) both;
        }
    
            .command-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0) 50%);
                opacity: 0;
                transition: opacity var(--transition-normal);
                z-index: 1;
            }
    
            .command-card:hover {
                transform: translateY(-6px) scale(1.03);
                box-shadow: var(--shadow-hover);
                background: var(--gradient-card);
                border-color: rgba(59, 130, 246, 0.4);
                animation: cardHover 0.4s var(--ease-out-back) both;
            }
    
            .command-card:hover::before {
                opacity: 1;
            }
    
            .command-card:active {
                transform: translateY(-2px) scale(1.01);
                box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
            }
        }

        .command-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-3);
        }

        .command-name {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--color-gray-900);
            margin-bottom: var(--space-1);
        }

        [data-theme="dark"] .command-name,
        :root:not([data-theme]) .command-name {
            color: var(--text-primary);
        }

        .command-category {
            display: flex;
            align-items: center;
            gap: var(--space-1_5);
            font-size: var(--text-xs);
            color: var(--color-gray-500);
        }

        .command-actions {
            display: flex;
            gap: var(--space-2);
        }

        .action-button {
            padding: var(--space-2);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-normal);
            border: none;
            background: transparent;
            color: var(--color-gray-500);
            position: relative;
            overflow: hidden;
            z-index: 2;
            transform-origin: center;
        }
        
        .action-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0) 100%);
            opacity: 0;
            transition: opacity var(--transition-normal);
            border-radius: var(--radius-md);
        }
        
        .action-button:hover {
            color: var(--color-primary);
            background: var(--color-gray-100);
            transform: scale(1.15);
            box-shadow: var(--shadow-sm);
            animation: buttonPulse 0.6s var(--ease-out-back) both;
        }
        
        .action-button:hover::before {
            opacity: 1;
        }
        
        .action-button.primary {
            color: var(--color-primary);
        }
        
        .action-button.primary:hover {
            background: var(--gradient-primary);
            color: var(--color-white);
            transform: scale(1.15);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            animation: buttonPulse 0.6s var(--ease-out-back) both;
        }
            
        .action-button.favorite {
            color: var(--color-warning);
        }
            
        .action-button.favorite:hover {
            background: linear-gradient(135deg, var(--color-warning), #f97316);
            color: var(--color-white);
            transform: scale(1.15);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
            animation: buttonPulse 0.6s var(--ease-out-back) both;
        }

        .command-code {
            background: var(--color-gray-100);
            padding: var(--space-3);
            border-radius: var(--radius-md);
            font-family: var(--font-family-mono);
            font-size: var(--text-sm);
            color: var(--color-gray-700);
            margin: var(--space-3) 0;
            word-break: break-all;
        }

        [data-theme="dark"] .command-code,
        :root:not([data-theme]) .command-code {
            background: var(--bg-muted);
            color: var(--text-secondary);
        }

        .command-description {
            color: var(--color-gray-500);
            font-size: var(--text-sm);
            line-height: 1.5;
            margin-bottom: var(--space-3);
        }

        .command-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: var(--text-xs);
            color: var(--color-gray-400);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-overlay);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--color-white);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            width: 90%;
            max-width: var(--modal-max-width-sm);
            max-height: var(--vh-80);
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-5);
        }

        .modal-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
        }

        .close-button {
            background: none;
            border: none;
            font-size: var(--text-2xl);
            cursor: pointer;
            color: var(--color-gray-400);
        }

        .form-group {
            margin-bottom: var(--space-4);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-1_5);
            font-weight: var(--font-medium);
            color: var(--color-gray-700);
        }

        .form-input {
            width: 100%;
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            outline: none;
            transition: border-color var(--transition-normal);
        }

        .form-input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-primary-shadow);
        }

        .form-textarea {
            resize: vertical;
            min-height: calc(var(--space-16) * 1.25);
        }

        .form-actions {
            display: flex;
            gap: var(--space-3);
            justify-content: flex-end;
            margin-top: var(--space-6);
        }

        .button {
            padding: var(--space-2) var(--space-5);
            border: 1px solid var(--border-secondary);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: var(--font-medium);
            cursor: pointer;
            transition: all var(--transition-normal);
            transform: translateY(0);
            position: relative;
            overflow: hidden;
        }

        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0) 100%);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .button:hover::before {
            opacity: 1;
        }

        .button:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(59, 130, 246, 0.2);
        }

        .button.secondary {
            background: var(--color-white);
            color: var(--color-gray-700);
        }

        .button.secondary:hover {
            background: var(--color-gray-100);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .button.primary {
            background: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .button.primary:hover {
            background: var(--color-primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
        }

        .button.primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }

        .button.primary:hover {
            background: var(--color-primary-hover);
        }

        .toast {
            position: fixed;
            top: var(--space-5);
            right: var(--space-5);
            background: var(--color-white);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-md);
            padding: var(--space-4);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-modal);
            transform: translateX(100%);
            transition: transform var(--transition-slow);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left: 4px solid var(--color-success);
        }

        .toast.error {
            border-left: 4px solid var(--color-error);
        }

        .empty-state {
            text-align: center;
            padding: var(--space-15) var(--space-5);
            color: var(--color-gray-400);
        }

        .empty-icon {
            font-size: var(--text-4xl);
            margin-bottom: var(--space-4);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-10);
        }

        .spinner {
            width: var(--size-8);
            height: var(--size-8);
            border: 3px solid var(--color-gray-100);
            border-top: 3px solid var(--color-primary);
            border-radius: 50%;
            animation: spin var(--transition-normal) linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .color-option {
            width: var(--size-8);
            height: var(--size-8);
            border-radius: var(--radius-md);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--transition-fast);
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: var(--color-gray-700);
            transform: scale(1.1);
        }

        /* 视觉优化 - 动画关键帧 */
        @keyframes cardEntrance {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes cardHover {
            0% {
                transform: translateY(0) scale(1);
            }
            100% {
                transform: translateY(-6px) scale(1.03);
            }
        }

        @keyframes buttonPulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1.15);
            }
        }

        @keyframes appEntrance {
            0% {
                opacity: 0;
                transform: scale(0.98);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- 侧边栏 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">
                        <img src="../assets/icon.png" alt="Logo" style="width: var(--size-8); height: var(--size-8); border-radius: var(--radius-md);">
                    </div>
                    <div>
                        <div style="font-weight: var(--font-semibold); font-size: var(--text-base);">命令管理</div>
                        <div style="font-size: var(--text-xs); color: var(--color-gray-500);">快速命令工具</div>
                    </div>
                </div>

                <div class="search-box">
                    <input type="text" class="search-input" placeholder="搜索命令..." id="searchInput">
                    <div class="search-icon">🔍</div>
                </div>
            </div>

            <div class="categories" id="categoriesList">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>

            <!-- 统计面板 -->
            <div style="padding: var(--space-5); border-top: 1px solid var(--border-primary); background: var(--color-gray-50);">
                <div style="font-size: var(--text-xs); color: var(--color-gray-500); margin-bottom: var(--space-2);">📊 统计信息</div>
                <div id="statsPanel" style="font-size: var(--text-xs); color: var(--color-gray-400); line-height: 1.4;">
                    <div>总命令: <span id="totalCommands">0</span></div>
                    <div>收藏: <span id="favoriteCommands">0</span></div>
                    <div>今日使用: <span id="todayUsage">0</span></div>
                </div>
            </div>

            <!-- 使用指南按钮 -->
            <div style="padding: var(--space-4) var(--space-5); border-top: 1px solid var(--border-primary); background: var(--color-gray-50);">
                <button onclick="showHelpModal()" style="
                    width: 100%;
                    padding: var(--space-2);
                    background: var(--color-gray-100);
                    border: 1px solid var(--border-secondary);
                    border-radius: var(--radius-md);
                    color: var(--color-gray-700);
                    font-size: var(--text-xs);
                    cursor: pointer;
                    transition: all var(--transition-normal);
                    margin-bottom: var(--space-2);
                ">
                    📖 使用指南
                </button>
                <button onclick="showChangelogModal()" style="
                    width: 100%;
                    padding: var(--space-2);
                    background: var(--color-gray-100);
                    border: 1px solid var(--border-secondary);
                    border-radius: var(--radius-md);
                    color: var(--color-gray-700);
                    font-size: var(--text-xs);
                    cursor: pointer;
                    transition: all var(--transition-normal);
                ">
                    📋 更新日志
                </button>
            </div>
        </div>

        <!-- 主内容区 -->
        <div class="main-content">
            <div class="header">
                <h1 class="header-title">命令列表</h1>
                <div style="display: flex; gap: var(--space-3);">
                    <button class="add-button" style="background: var(--color-success);" onclick="exportData()" title="导出数据">📤 导出</button>
                    <button class="add-button" style="background: var(--color-warning);" onclick="document.getElementById('importFile').click()" title="导入数据">📥 导入</button>
                    <button class="add-button" onclick="showAddModal()">+ 新建命令</button>
                </div>
            </div>

            <!-- 隐藏的文件输入 -->
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">

            <div class="commands-container" id="commandsList">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 使用指南模态框 -->
    <div class="modal" id="helpModal">
        <div class="modal-content" style="max-width: var(--modal-max-width);">
            <div class="modal-header">
                <h2 class="modal-title">📖 使用指南</h2>
                <button class="close-button" onclick="hideHelpModal()">&times;</button>
            </div>

            <div style="padding: 0 var(--space-5) var(--space-5); max-height: var(--vh-60); overflow-y: auto;">
                <h3 style="margin-bottom: var(--space-4); color: var(--color-gray-900);">快速开始</h3>
                
                <div style="margin-bottom: var(--space-6);">
                    <h4 style="margin-bottom: var(--space-2); color: var(--color-gray-700);">🎯 核心功能</h4>
                    <ul style="color: var(--color-gray-500); line-height: 1.6; margin-left: var(--space-4);">
                        <li><strong>新建命令</strong> - 点击右上角"+ 新建命令"按钮</li>
                        <li><strong>搜索命令</strong> - 使用搜索框或快捷键 Cmd/Ctrl + F</li>
                        <li><strong>复制命令</strong> - 点击命令卡片上的"复制"按钮</li>
                        <li><strong>收藏命令</strong> - 点击❤️图标添加到收藏</li>
                    </ul>
                </div>

                <div style="margin-bottom: var(--space-6);">
                    <h4 style="margin-bottom: var(--space-2); color: var(--color-gray-700);">⌨️ 快捷键</h4>
                    <ul style="color: var(--color-gray-500); line-height: 1.6; margin-left: var(--space-4);">
                        <li><strong>Cmd/Ctrl + N</strong> - 新建命令</li>
                        <li><strong>Cmd/Ctrl + F</strong> - 聚焦搜索框</li>
                        <li><strong>Esc</strong> - 关闭模态框</li>
                        <li><strong>Cmd/Ctrl + 1-5</strong> - 快速切换分类</li>
                    </ul>
                </div>

                <div style="margin-bottom: var(--space-6);">
                    <h4 style="margin-bottom: var(--space-2); color: var(--color-gray-700);">📊 分类管理</h4>
                    <ul style="color: var(--color-gray-500); line-height: 1.6; margin-left: var(--space-4);">
                        <li>在侧边栏底部点击"新建分类"</li>
                        <li>为分类选择颜色以便区分</li>
                        <li>使用分类筛选命令</li>
                    </ul>
                </div>

                <div style="margin-bottom: var(--space-6);">
                    <h4 style="margin-bottom: var(--space-2); color: var(--color-gray-700);">📁 数据管理</h4>
                    <ul style="color: var(--color-gray-500); line-height: 1.6; margin-left: var(--space-4);">
                        <li><strong>导出数据</strong> - 备份所有命令和分类</li>
                        <li><strong>导入数据</strong> - 从JSON文件恢复数据</li>
                        <li>数据自动保存在本地数据库中</li>
                    </ul>
                </div>

                <div style="background: var(--color-gray-100); padding: var(--space-4); border-radius: var(--radius-md); border-left: 4px solid var(--color-primary);">
                    <h4 style="margin-bottom: var(--space-2); color: var(--color-gray-900);">💡 小贴士</h4>
                    <p style="color: var(--color-gray-500); line-height: 1.6; margin: 0;">
                        使用描述和标签让命令更容易找到。定期导出数据以防意外丢失。
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加分类模态框 -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">新建分类</h2>
                <button class="close-button" onclick="hideCategoryModal()">&times;</button>
            </div>

            <form id="categoryForm">
                <div class="form-group">
                    <label class="form-label">分类名称 *</label>
                    <input type="text" class="form-input" id="categoryName" required>
                </div>

                <div class="form-group">
                    <label class="form-label">分类描述</label>
                    <textarea class="form-input form-textarea" id="categoryDescription"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">分类颜色</label>
                    <div style="display: flex; gap: var(--space-2); flex-wrap: wrap; margin-top: var(--space-2);">
                        <div class="color-option" data-color="var(--color-primary)" style="background: var(--color-primary);"></div>
                        <div class="color-option" data-color="var(--color-error)" style="background: var(--color-error);"></div>
                        <div class="color-option" data-color="var(--color-success)" style="background: var(--color-success);"></div>
                        <div class="color-option" data-color="var(--color-warning)" style="background: var(--color-warning);"></div>
                        <div class="color-option" data-color="var(--color-purple)" style="background: var(--color-purple);"></div>
                        <div class="color-option" data-color="var(--color-pink)" style="background: var(--color-pink);"></div>
                        <div class="color-option" data-color="var(--color-cyan)" style="background: var(--color-cyan);"></div>
                        <div class="color-option" data-color="var(--color-lime)" style="background: var(--color-lime);"></div>
                    </div>
                    <input type="hidden" id="categoryColor" value="var(--color-primary)">
                </div>

                <div class="form-actions">
                    <button type="button" class="button secondary" onclick="hideCategoryModal()">取消</button>
                    <button type="submit" class="button primary">创建分类</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 更新日志模态框 -->
    <div class="modal" id="changelogModal">
        <div class="modal-content" style="max-width: var(--size-xxl); max-height: var(--vh-80);">
            <div class="modal-header">
                <h2 class="modal-title">📋 系统更新日志</h2>
                <button class="close-button" onclick="hideChangelogModal()">&times;</button>
            </div>

            <div style="padding: 0 var(--space-5) var(--space-5); max-height: var(--vh-60); overflow-y: auto;">
                <div id="changelogContent" style="font-family: var(--font-family-mono); font-size: var(--text-sm); line-height: 1.5; color: var(--color-gray-700);">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <div class="form-actions" style="justify-content: center; margin-top: var(--space-4);">
                <button class="button secondary" onclick="hideChangelogModal()">关闭</button>
            </div>
        </div>
    </div>

    <!-- 添加/编辑命令模态框 -->
    <div class="modal" id="commandModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">新建命令</h2>
                <button class="close-button" onclick="hideModal()">&times;</button>
            </div>

            <form id="commandForm">
                <div class="form-group">
                    <label class="form-label">命令名称 *</label>
                    <input type="text" class="form-input" id="commandName" required>
                </div>

                <div class="form-group">
                    <label class="form-label">命令内容 *</label>
                    <textarea class="form-input form-textarea" id="commandCode" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">描述</label>
                    <textarea class="form-input form-textarea" id="commandDescription"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">分类</label>
                    <select class="form-input" id="commandCategory">
                        <option value="">选择分类</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">标签</label>
                    <input type="text" class="form-input" id="commandTags" placeholder="用逗号分隔多个标签">
                </div>

                <div class="form-actions">
                    <button type="button" class="button secondary" onclick="hideModal()">取消</button>
                    <button type="submit" class="button primary">保存</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // 全局变量
        let commands = [];
        let categories = [];
        let currentCategory = null;
        let searchTerm = '';
        let editingCommand = null;
        let showFavorites = false;
        let showRecent = false;

        // API 基础URL - 自动检测环境
const API_BASE = (() => {
  // 如果是Electron环境，使用localhost:9091
  if (typeof window !== 'undefined' && window.electronAPI) {
    return 'http://localhost:9091/api';
  }
  // 如果是Web环境，使用当前域名（开发环境使用localhost:9091）
  if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
    return 'http://localhost:9091/api';
  }
  return `${window.location.origin}/api`;
})();

        // 初始化应用
        async function init() {
            await loadCategories();
            await loadCommands();
        }

        // 加载分类
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories`);
                const data = await response.json();
                if (data.success) {
                    categories = data.data;
                    renderCategories();
                    updateCategorySelect();
                }
            } catch (error) {
                showToast('加载分类失败', 'error');
            }
        }

        // 加载命令
        async function loadCommands() {
            try {
                let url = `${API_BASE}/commands`;
                const params = new URLSearchParams();

                if (currentCategory) {
                    params.append('category_id', currentCategory);
                }
                if (searchTerm) {
                    params.append('search', searchTerm);
                }
                if (showFavorites) {
                    params.append('favorite', 'true');
                }

                if (params.toString()) {
                    url += '?' + params.toString();
                }

                const response = await fetch(url);
                const data = await response.json();
                if (data.success) {
                    commands = data.data;

                    // 如果是最近常用过滤，使用本地过滤
                    if (showRecent) {
                        commands = getRecentCommands();
                    }

                    renderCommands();
                }
            } catch (error) {
                showToast('加载命令失败', 'error');
            }
        }

        // 渲染分类列表
        function renderCategories() {
            const container = document.getElementById('categoriesList');

            let html = `
                <div class="category-item ${!currentCategory && !showFavorites && !showRecent ? 'active' : ''}" onclick="selectCategory(null)">
                    <div class="category-color" style="background: var(--color-gray-500);"></div>
                    <span>全部命令</span>
                    <span class="category-count">${commands.length}</span>
                </div>
                <div class="category-item ${showRecent ? 'active' : ''}" onclick="toggleRecentFilter()">
                    <div class="category-color" style="background: var(--color-primary);">🕒</div>
                    <span>最近常用</span>
                    <span class="category-count">${getRecentCommands().length}</span>
                </div>
                <div class="category-item ${showFavorites ? 'active' : ''}" onclick="toggleFavoriteFilter()">
                    <div class="category-color" style="background: var(--color-error);">❤️</div>
                    <span>收藏的命令</span>
                    <span class="category-count">${commands.filter(cmd => cmd.is_favorite).length}</span>
                </div>
            `;

            categories.forEach(category => {
                html += `
                    <div class="category-item ${currentCategory === category.id ? 'active' : ''}" onclick="selectCategory(${category.id})">
                        <div class="category-color" style="background: ${category.color};"></div>
                        <span>${category.name}</span>
                        <span class="category-count">${category.command_count}</span>
                    </div>
                `;
            });

            // 添加创建分类按钮
            html += `
                <div class="category-item" onclick="showAddCategoryModal()" style="border: 1px dashed var(--border-secondary); margin-top: var(--space-2);">
                    <div class="category-color" style="background: var(--color-gray-100); display: flex; align-items: center; justify-content: center; color: var(--color-gray-400);">+</div>
                    <span style="color: var(--color-gray-500);">新建分类</span>
                </div>
            `;

            container.innerHTML = html;
        }

        // 渲染命令列表
        function renderCommands() {
            const container = document.getElementById('commandsList');

            if (commands.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📝</div>
                        <h3>还没有命令</h3>
                        <p>点击"新建命令"按钮创建您的第一个命令</p>
                    </div>
                `;
                return;
            }

            let html = '';
            commands.forEach(command => {
                html += `
                    <div class="command-card">
                        <div class="command-header">
                            <div>
                                <div class="command-name">${command.name}</div>
                                ${command.category_name ? `
                                    <div class="command-category">
                                        <div class="category-color" style="background: ${command.category_color};"></div>
                                        ${command.category_name}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="command-actions">
                                <button class="action-button ${command.is_favorite ? 'favorite' : ''}" onclick="toggleFavorite(${command.id})" title="${command.is_favorite ? '取消收藏' : '添加收藏'}">
                                    ${command.is_favorite ? '❤️' : '🤍'}
                                </button>
                                <button class="action-button primary" onclick="copyCommand('${command.command.replace(/'/g, "\\'")}', ${command.id})">复制</button>
                                <button class="action-button" onclick="editCommand(${command.id})">编辑</button>
                                <button class="action-button" onclick="deleteCommand(${command.id})">删除</button>
                            </div>
                        </div>

                        <div class="command-code">${command.command}</div>

                        ${command.description ? `<div class="command-description">${command.description}</div>` : ''}

                        <div class="command-meta">
                            <span>使用 ${command.usage_count} 次</span>
                            <span>最后使用: ${command.last_used ? new Date(command.last_used).toLocaleString() : '从未使用'}</span>
                            <span>创建于: ${new Date(command.created_at).toLocaleDateString()}</span>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            updateStats();
        }

        // 更新统计信息
        function updateStats() {
            const totalCommands = commands.length;
            const favoriteCommands = commands.filter(cmd => cmd.is_favorite).length;
            const today = new Date().toDateString();
            const todayUsage = commands.reduce((total, cmd) => {
                const lastUsed = cmd.last_used ? new Date(cmd.last_used).toDateString() : null;
                return total + (lastUsed === today ? 1 : 0);
            }, 0);

            document.getElementById('totalCommands').textContent = totalCommands;
            document.getElementById('favoriteCommands').textContent = favoriteCommands;
            document.getElementById('todayUsage').textContent = todayUsage;
        }

        // 更新分类选择框
        function updateCategorySelect() {
            const select = document.getElementById('commandCategory');
            let html = '<option value="">选择分类</option>';

            categories.forEach(category => {
                html += `<option value="${category.id}">${category.name}</option>`;
            });

            select.innerHTML = html;
        }

        // 选择分类
        function selectCategory(categoryId) {
            currentCategory = categoryId;
            showFavorites = false;
            showRecent = false;
            loadCommands();
            renderCategories();
        }

        // 切换收藏过滤
        function toggleFavoriteFilter() {
            showFavorites = !showFavorites;
            showRecent = false;
            currentCategory = null;
            loadCommands();
            renderCategories();
        }

        // 切换最近常用过滤
        function toggleRecentFilter() {
            showRecent = !showRecent;
            showFavorites = false;
            currentCategory = null;
            loadCommands();
            renderCategories();
        }

        // 获取最近常用命令（按使用次数和最后使用时间排序）
        function getRecentCommands() {
            const now = new Date();
            const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);

            return commands
                .filter(cmd => cmd.usage_count > 0) // 至少使用过一次
                .sort((a, b) => {
                    // 优先按使用次数排序，然后按最后使用时间
                    if (b.usage_count !== a.usage_count) {
                        return b.usage_count - a.usage_count;
                    }
                    const aTime = a.last_used ? new Date(a.last_used) : new Date(a.updated_at);
                    const bTime = b.last_used ? new Date(b.last_used) : new Date(b.updated_at);
                    return bTime - aTime;
                })
                .slice(0, 10); // 只显示前10个
        }

        // 切换收藏状态
        async function toggleFavorite(commandId) {
            try {
                const command = commands.find(c => c.id === commandId);
                if (!command) return;

                const response = await fetch(`${API_BASE}/commands/${commandId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ is_favorite: !command.is_favorite })
                });

                const data = await response.json();

                if (data.success) {
                    showToast(command.is_favorite ? '已取消收藏' : '已添加到收藏', 'success');
                    loadCommands();
                    loadCategories();
                } else {
                    showToast('操作失败', 'error');
                }
            } catch (error) {
                showToast('操作失败', 'error');
            }
        }

        // 搜索命令
        function searchCommands() {
            searchTerm = document.getElementById('searchInput').value;
            loadCommands();
        }

        // 复制命令
        async function copyCommand(command, commandId) {
            try {
                await navigator.clipboard.writeText(command);
                showToast('命令已复制到剪贴板', 'success');

                // 增加使用次数
                await fetch(`${API_BASE}/commands/${commandId}/use`, { method: 'POST' });
                loadCommands();
            } catch (error) {
                showToast('复制失败', 'error');
            }
        }

        // 显示添加分类模态框
        function showAddCategoryModal() {
            document.getElementById('categoryForm').reset();
            document.getElementById('categoryColor').value = 'var(--color-primary)';
            // 重置颜色选择
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector('.color-option[data-color="var(--color-primary)"]').classList.add('selected');
            document.getElementById('categoryModal').classList.add('show');
        }

        // 隐藏分类模态框
        function hideCategoryModal() {
            document.getElementById('categoryModal').classList.remove('show');
        }

        // 显示帮助模态框
        function showHelpModal() {
            document.getElementById('helpModal').classList.add('show');
        }

        // 隐藏帮助模态框
        function hideHelpModal() {
            document.getElementById('helpModal').classList.remove('show');
        }

        // 显示添加模态框
        function showAddModal() {
            editingCommand = null;
            document.getElementById('modalTitle').textContent = '新建命令';
            document.getElementById('commandForm').reset();
            document.getElementById('commandModal').classList.add('show');
        }

        // 编辑命令
        function editCommand(commandId) {
            const command = commands.find(c => c.id === commandId);
            if (!command) return;

            editingCommand = command;
            document.getElementById('modalTitle').textContent = '编辑命令';
            document.getElementById('commandName').value = command.name;
            document.getElementById('commandCode').value = command.command;
            document.getElementById('commandDescription').value = command.description || '';
            document.getElementById('commandCategory').value = command.category_id || '';
            document.getElementById('commandTags').value = command.tags || '';
            document.getElementById('commandModal').classList.add('show');
        }

        // 删除命令
        async function deleteCommand(commandId) {
            if (!confirm('确定要删除这个命令吗？')) return;

            try {
                const response = await fetch(`${API_BASE}/commands/${commandId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();

                if (data.success) {
                    showToast('命令删除成功', 'success');
                    loadCommands();
                    loadCategories();
                } else {
                    showToast('删除失败', 'error');
                }
            } catch (error) {
                showToast('删除失败', 'error');
            }
        }

        // 隐藏模态框
        function hideModal() {
            document.getElementById('commandModal').classList.remove('show');
        }

        // 显示更新日志模态框
        async function showChangelogModal() {
            const modal = document.getElementById('changelogModal');
            const content = document.getElementById('changelogContent');
            
            // 显示加载状态
            content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            modal.classList.add('show');
            
            try {
                // 通过Electron API获取更新日志
                const changelog = await window.electronAPI.getChangelog();
                
                if (changelog) {
                    // 格式化显示更新日志
                    let html = `<div style="margin-bottom: var(--space-5);">
                        <div style="font-size: var(--text-base); font-weight: 600; color: var(--color-gray-900); margin-bottom: var(--space-2);">
                            📦 版本 v${changelog.version}
                        </div>
                        <div style="background: var(--color-gray-100); padding: var(--space-4); border-radius: var(--radius-md); border-left: 4px solid var(--color-primary);">
                            <div style="font-weight: 600; margin-bottom: var(--space-2); color: var(--color-gray-700);">✨ 主要更新：</div>
                            <div style="white-space: pre-wrap; color: var(--color-gray-500); line-height: 1.6;">${changelog.features}</div>
                        </div>
                    </div>`;
                    
                    // 添加完整日志链接
                    html += `<div style="text-align: center; margin-top: var(--space-5); padding-top: var(--space-4); border-top: 1px solid var(--border-primary);">
                        <div style="font-size: var(--text-xs); color: var(--color-gray-400); margin-bottom: var(--space-2);">
                            查看完整更新日志请查看 CHANGELOG.md 文件
                        </div>
                    </div>`;
                    
                    content.innerHTML = html;
                } else {
                    content.innerHTML = '<div style="text-align: center; color: var(--color-gray-400); padding: var(--space-10);">' +
                    '<div style="font-size: var(--text-4xl); margin-bottom: var(--space-4);">📄</div>' +
                    '<div>更新日志文件不存在或格式不正确</div>' +
                '</div>';
                }
            } catch (error) {
                console.error('加载更新日志失败:', error);
                content.innerHTML = '<div style="text-align: center; color: var(--color-error); padding: var(--space-10);">' +
                    '<div style="font-size: var(--text-4xl); margin-bottom: var(--space-4);">❌</div>' +
                    '<div>加载更新日志失败</div>' +
                '</div>';
            }
        }

        // 隐藏更新日志模态框
        function hideChangelogModal() {
            document.getElementById('changelogModal').classList.remove('show');
        }

        // 保存命令
        async function saveCommand(event) {
            event.preventDefault();

            const formData = {
                name: document.getElementById('commandName').value,
                command: document.getElementById('commandCode').value,
                description: document.getElementById('commandDescription').value,
                category_id: document.getElementById('commandCategory').value || null,
                tags: document.getElementById('commandTags').value
            };

            try {
                let response;
                if (editingCommand) {
                    response = await fetch(`${API_BASE}/commands/${editingCommand.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                } else {
                    response = await fetch(`${API_BASE}/commands`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                }

                const data = await response.json();

                if (data.success) {
                    showToast(editingCommand ? '命令更新成功' : '命令创建成功', 'success');
                    hideModal();
                    loadCommands();
                    loadCategories();
                } else {
                    showToast('保存失败', 'error');
                }
            } catch (error) {
                showToast('保存失败', 'error');
            }
        }

        // 导出数据
        async function exportData() {
            try {
                const [commandsData, categoriesData] = await Promise.all([
                    fetch(`${API_BASE}/commands`).then(r => r.json()),
                    fetch(`${API_BASE}/categories`).then(r => r.json())
                ]);

                const exportData = {
                    commands: commandsData.data || [],
                    categories: categoriesData.data || [],
                    exportDate: new Date().toISOString(),
                    version: '1.0.0'
                };

                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `commands-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                showToast('数据导出成功', 'success');
            } catch (error) {
                showToast('导出失败', 'error');
            }
        }

        // 导入数据
        async function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                const data = JSON.parse(text);

                if (!data.commands || !data.categories) {
                    showToast('无效的数据格式', 'error');
                    return;
                }

                let importedCommands = 0;
                let importedCategories = 0;

                // 导入分类
                for (const category of data.categories) {
                    try {
                        await fetch(`${API_BASE}/categories`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                name: category.name,
                                description: category.description,
                                color: category.color
                            })
                        });
                        importedCategories++;
                    } catch (error) {
                        console.warn('导入分类失败:', category.name);
                    }
                }

                // 导入命令
                for (const command of data.commands) {
                    try {
                        await fetch(`${API_BASE}/commands`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                name: command.name,
                                command: command.command,
                                description: command.description,
                                category_id: command.category_id,
                                tags: command.tags,
                                is_favorite: command.is_favorite || false
                            })
                        });
                        importedCommands++;
                    } catch (error) {
                        console.warn('导入命令失败:', command.name);
                    }
                }

                showToast(`导入成功：${importedCommands} 个命令，${importedCategories} 个分类`, 'success');
                loadCommands();
                loadCategories();
            } catch (error) {
                showToast('导入失败：' + error.message, 'error');
            }

            // 重置文件输入
            event.target.value = '';
        }

        // 显示提示
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type} show`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // 快捷键支持
        document.addEventListener('keydown', function(event) {
            // Cmd/Ctrl + N: 新建命令
            if ((event.metaKey || event.ctrlKey) && event.key === 'n') {
                event.preventDefault();
                showAddModal();
            }

            // Cmd/Ctrl + F: 聚焦搜索框
            if ((event.metaKey || event.ctrlKey) && event.key === 'f') {
                event.preventDefault();
                document.getElementById('searchInput').focus();
            }

            // Escape: 关闭模态框
            if (event.key === 'Escape') {
                hideModal();
            }

            // Cmd/Ctrl + 1-5: 快速切换分类
            if ((event.metaKey || event.ctrlKey) && event.key >= '1' && event.key <= '5') {
                event.preventDefault();
                const categoryIndex = parseInt(event.key) - 1;
                if (categoryIndex === 0) {
                    selectCategory(null);
                } else if (categories[categoryIndex - 1]) {
                    selectCategory(categories[categoryIndex - 1].id);
                }
            }
        });

        // 保存分类
        async function saveCategory(event) {
            event.preventDefault();

            const formData = {
                name: document.getElementById('categoryName').value,
                description: document.getElementById('categoryDescription').value,
                color: document.getElementById('categoryColor').value
            };

            try {
                const response = await fetch(`${API_BASE}/categories`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success) {
                    showToast('分类创建成功', 'success');
                    hideCategoryModal();
                    loadCategories();
                } else {
                    showToast('创建失败: ' + (data.error || '未知错误'), 'error');
                }
            } catch (error) {
                showToast('创建失败', 'error');
            }
        }

        // 事件监听
        document.getElementById('searchInput').addEventListener('input', searchCommands);
        document.getElementById('commandForm').addEventListener('submit', saveCommand);
        document.getElementById('categoryForm').addEventListener('submit', saveCategory);

        // 颜色选择器事件
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('color-option')) {
                // 移除所有选中状态
                document.querySelectorAll('.color-option').forEach(option => {
                    option.classList.remove('selected');
                });
                // 添加选中状态
                event.target.classList.add('selected');
                // 设置颜色值
                document.getElementById('categoryColor').value = event.target.dataset.color;
            }
        });

        // 主题管理器
        class ThemeManager {
            constructor() {
                this.currentTheme = this.getStoredTheme() || this.getSystemTheme();
                this.applyTheme(this.currentTheme);
                this.setupSystemThemeListener();
            }

            getStoredTheme() {
                try {
                    return localStorage.getItem('theme');
                } catch (error) {
                    console.warn('无法访问localStorage:', error);
                    return null;
                }
            }

            getSystemTheme() {
                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }

            applyTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                this.currentTheme = theme;
                this.dispatchThemeChangeEvent(theme);
            }

            toggleTheme() {
                const newTheme = this.currentTheme === 'dark' ? 'light' : 'dark';
                this.applyTheme(newTheme);
                this.storeTheme(newTheme);
            }

            storeTheme(theme) {
                try {
                    localStorage.setItem('theme', theme);
                } catch (error) {
                    console.warn('无法存储主题到localStorage:', error);
                }
            }

            setupSystemThemeListener() {
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                mediaQuery.addEventListener('change', (e) => {
                    if (!this.hasUserOverride()) {
                        this.applyTheme(e.matches ? 'dark' : 'light');
                    }
                });
            }

            hasUserOverride() {
                return localStorage.getItem('theme') !== null;
            }

            dispatchThemeChangeEvent(theme) {
                const event = new CustomEvent('themechange', {
                    detail: { theme }
                });
                document.dispatchEvent(event);
            }

            resetToSystemTheme() {
                localStorage.removeItem('theme');
                this.applyTheme(this.getSystemTheme());
            }
        }

        // 初始化主题管理器
        const themeManager = new ThemeManager();

        // 主题切换按钮处理
        function setupThemeToggle() {
            const toggleBtn = document.createElement('button');
            toggleBtn.className = 'theme-toggle';
            toggleBtn.innerHTML = `
                <span class="theme-icon">🌙</span>
                <span class="theme-text">切换主题</span>
            `;
            
            toggleBtn.addEventListener('click', () => {
                themeManager.toggleTheme();
                updateToggleButton();
            });

            // 添加到页面 - 在使用指南按钮上方
            const helpButtonSection = document.querySelector('.sidebar > div:has(button[onclick="showHelpModal()"])');
            if (helpButtonSection) {
                helpButtonSection.parentNode.insertBefore(toggleBtn, helpButtonSection);
            } else {
                // 备用方案：添加到侧边栏底部
                const sidebar = document.querySelector('.sidebar');
                if (sidebar) {
                    sidebar.appendChild(toggleBtn);
                }
            }

            updateToggleButton();

            function updateToggleButton() {
                const icon = toggleBtn.querySelector('.theme-icon');
                const text = toggleBtn.querySelector('.theme-text');
                
                if (themeManager.currentTheme === 'dark') {
                    icon.textContent = '☀️';
                    text.textContent = '切换到亮色';
                } else {
                    icon.textContent = '🌙';
                    text.textContent = '切换到深色';
                }
            }
        }

        // 页面加载完成后设置主题切换
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupThemeToggle);
        } else {
            setupThemeToggle();
        }

        // 初始化应用
        init();
    </script>
</body>
</html>
